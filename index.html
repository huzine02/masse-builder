<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masse Builder v3.2 Ultimate - Phase S√®che</title> <!-- üÜï NOUVEAU: v3.2 Ultimate avec am√©liorations UX -->
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: #333;}
        .container {max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);}
        h1 {text-align: center; color: #667eea; margin-bottom: 5px; font-size: 26px;}
        .version-badge {text-align: center; background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 10px;}
        .header-info {text-align: center; color: #666; margin-bottom: 15px; font-size: 13px;}
        .week-tracker {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center;}
        .week-display {font-size: 32px; font-weight: bold; margin: 10px 0;}
        .week-controls {display: flex; gap: 8px; justify-content: center; margin-top: 10px;}
        .session-timer {background: #fff3cd; border: 2px solid #ffc107; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-weight: bold;}
        .session-timer-display {font-size: 24px; color: #667eea; margin: 5px 0; font-variant-numeric: tabular-nums;}
        .session-controls {display: flex; gap: 8px; justify-content: center; margin-top: 10px;}
        .photo-upload-section {background: #f8f9ff; border-radius: 15px; padding: 15px; margin: 10px 0;}
        .photo-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px;}
        .photo-item {position: relative; aspect-ratio: 3/4; background: #e0e0e0; border-radius: 8px; overflow: hidden; cursor: pointer; border: 3px dashed #667eea;}
        .photo-item.has-photo {border: 3px solid #51cf66;}
        .photo-item img {width: 100%; height: 100%; object-fit: cover;}
        .photo-placeholder {display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 12px; text-align: center; padding: 5px;}
        .photo-delete {position: absolute; top: 5px; right: 5px; background: #ff6b6b; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: none;}
        .photo-item:hover .photo-delete {display: block;}
        .photo-comparison {display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;}
        .comparison-week {background: white; border-radius: 10px; padding: 10px; text-align: center;}
        .comparison-week h4 {color: #667eea; margin-bottom: 10px; font-size: 14px;}
        .comparison-photos {display: flex; gap: 5px; justify-content: center;}
        .comparison-photo {width: 60px; height: 80px; background: #f0f0f0; border-radius: 5px; overflow: hidden;}
        .comparison-photo img {width: 100%; height: 100%; object-fit: cover;}
        .auto-save-indicator {position: fixed; top: 20px; right: 20px; background: #51cf66; color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: bold; opacity: 0; transition: opacity 0.3s; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
        .auto-save-indicator.show {opacity: 1;}
        /* üÜï NOUVEAU: Timer flottant persistant */
        .floating-timer {position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; border-radius: 15px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 999; display: none; min-width: 200px;}
        .floating-timer.active {display: block; animation: slideInUp 0.3s;}
        @keyframes slideInUp {from {transform: translateY(100px); opacity: 0;} to {transform: translateY(0); opacity: 1;}}
        .floating-timer-title {font-size: 11px; opacity: 0.9; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;}
        .floating-timer-display {font-size: 32px; font-weight: bold; margin: 5px 0; font-variant-numeric: tabular-nums;}
        .floating-timer-display.warning {color: #ffc107; animation: pulse 1s infinite;}
        .floating-timer-controls {display: flex; gap: 5px; margin-top: 10px;}
        .floating-timer-controls button {padding: 6px 12px; background: rgba(255,255,255,0.2); border: 1px solid white; border-radius: 6px; color: white; font-size: 11px; font-weight: bold; cursor: pointer; flex: 1;}
        .floating-timer-controls button:hover {background: rgba(255,255,255,0.3);}
        /* üÜï NOUVEAU: Guidage transition automatique */
        .transition-guide {position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 998; display: none; min-width: 300px; text-align: center;}
        .transition-guide.show {display: block; animation: bounceIn 0.5s;}
        @keyframes bounceIn {0% {transform: translateX(-50%) scale(0.3); opacity: 0;} 50% {transform: translateX(-50%) scale(1.05);} 70% {transform: translateX(-50%) scale(0.9);} 100% {transform: translateX(-50%) scale(1); opacity: 1;}}
        .transition-guide-title {font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 15px;}
        .transition-guide-buttons {display: flex; gap: 10px; justify-content: center;}
        /* üÜï NOUVEAU: Toggle √©chauffement */
        .warmup-toggle {background: #fff3cd; border: 2px solid #ffc107; padding: 12px; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between;}
        .warmup-toggle-label {font-weight: bold; font-size: 14px;}
        .toggle-switch {position: relative; display: inline-block; width: 60px; height: 30px;}
        .toggle-switch input {opacity: 0; width: 0; height: 0;}
        .toggle-slider {position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 30px;}
        .toggle-slider:before {position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;}
        input:checked + .toggle-slider {background-color: #51cf66;}
        input:checked + .toggle-slider:before {transform: translateX(30px);}
        /* FIN styles üÜï */
        .tabs {display: grid; grid-template-columns: repeat(auto-fit, minmax(85px, 1fr)); gap: 8px; margin-bottom: 20px;} /* üÜï NOUVEAU: 85px pour 6 tabs */
        .tab {padding: 12px 8px; background: #f0f0f0; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 13px;}
        .tab.active {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);}
        .tab-content {display: none;}
        .tab-content.active {display: block; animation: fadeIn 0.4s;}
        @keyframes fadeIn {from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);}}
        .workout-section {background: #f8f9ff; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #667eea;}
        .workout-section h3 {color: #667eea; margin-bottom: 12px; font-size: 18px;}
        .exercise {background: white; padding: 12px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative;}
        .progress-indicator {position: absolute; top: 10px; right: 10px; font-size: 20px;}
        .exercise-header {display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; gap: 10px;}
        .exercise-title {font-weight: bold; color: #333; font-size: 15px; flex: 1;}
        .demo-btn {padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: bold; cursor: pointer; white-space: nowrap; transition: transform 0.2s;}
        .demo-btn:active {transform: scale(0.95);}
        .last-week-data {background: #e8f5e9; border-left: 3px solid #51cf66; padding: 8px; margin: 8px 0; border-radius: 6px; font-size: 12px;}
        .suggested-weight {background: #fff9e6; border-left: 3px solid #ffc107; padding: 8px; margin: 8px 0; border-radius: 6px; font-size: 12px; font-weight: bold;}
        .performance-analysis {padding: 8px; margin: 8px 0; border-radius: 6px; font-size: 12px; font-weight: bold; display: none;}
        .performance-analysis.perfect {background: #e8f5e9; border-left: 3px solid #51cf66;}
        .performance-analysis.easy {background: #fff9e6; border-left: 3px solid #ffc107;}
        .performance-analysis.good {background: #ffe8cc; border-left: 3px solid #ff9800;}
        .performance-analysis.hard {background: #ffebee; border-left: 3px solid #f44336;}
        .performance-analysis.too_hard {background: #f5f5f5; border-left: 3px solid #424242;}
        .exercise-visual {background: #f0f0f0; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 12px; line-height: 1.6; border-left: 3px solid #ffa500;}
        .exercise-details {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 6px; margin: 8px 0; font-size: 12px;}
        .detail-item {background: #f0f0f0; padding: 5px 8px; border-radius: 6px;}
        .detail-label {font-weight: bold; color: #667eea;}
        .movement-diagram {background: white; border: 2px dashed #667eea; border-radius: 8px; padding: 8px; margin: 8px 0; font-size: 24px; text-align: center;}
        .sets-tracker {display: grid; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: 6px; margin-top: 10px;}
        .set-input label {font-size: 10px; font-weight: bold; color: #666; display: block; margin-bottom: 3px;}
        .set-input input {width: 100%; padding: 6px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 13px; text-align: center; transition: all 0.3s;}
        .set-input input:focus {outline: none; border-color: #667eea;}
        .set-input input.input-red {border-color: #ff6b6b; background: #fff5f5;}
        .set-input input.input-yellow {border-color: #ffc107; background: #fffbf0;}
        .set-input input.input-green {border-color: #51cf66; background: #f0fff4;}
        .timer {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 15px; text-align: center; margin: 15px 0;}
        .timer-display {font-size: 42px; font-weight: bold; margin: 10px 0; font-variant-numeric: tabular-nums;}
        .timer-display.warning {color: #ffc107; animation: pulse 1s infinite;}
        @keyframes pulse {0%, 100% {transform: scale(1);} 50% {transform: scale(1.05);}}
        .timer-controls {display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;}
        .btn {padding: 10px 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s; font-size: 13px;}
        .btn-primary {background: white; color: #667eea;}
        .btn-primary:hover {transform: scale(1.05);}
        .btn-primary:disabled {opacity: 0.5; cursor: not-allowed;}
        .btn-secondary {background: rgba(255,255,255,0.2); color: white; border: 2px solid white;}
        .btn-success {background: #51cf66; color: white;}
        .notification-setup {background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 12px; margin-bottom: 15px; font-size: 13px;}
        .notification-setup h3 {font-size: 16px; margin-bottom: 8px;}
        .alert {background: #ff6b6b; color: white; padding: 10px; border-radius: 8px; margin: 8px 0; font-size: 13px;}
        .success {background: #51cf66; color: white; padding: 10px; border-radius: 8px; margin: 8px 0; font-size: 13px;}
        .warning {background: #ffc107; color: #333; padding: 10px; border-radius: 8px; margin: 8px 0; font-size: 13px; font-weight: bold;}
        .notes-area {width: 100%; min-height: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 13px; margin-top: 10px;}
        .warmup {background: #fff4e6; border-left-color: #ffa500;}
        .progress-item {display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; margin: 8px 0; border-radius: 8px; font-size: 13px;}
        .progress-item input {width: 80px; padding: 6px; border: 2px solid #e0e0e0; border-radius: 6px; text-align: center; font-size: 13px;}
        .progression-table {width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 12px;}
        .progression-table th {background: #667eea; color: white; padding: 8px; text-align: left; font-size: 11px;}
        .progression-table td {padding: 8px; border-bottom: 1px solid #e0e0e0;}
        .progression-table tr:hover {background: #f8f9ff;}
        .week-badge {display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;}
        .week-badge.current {background: #667eea; color: white;}
        .week-badge.completed {background: #51cf66; color: white;}
        .week-badge.future {background: #e0e0e0; color: #666;}
        ul {margin-left: 20px; line-height: 1.6;}
        .modal {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; overflow-y: auto; padding: 20px;}
        .modal.show {display: flex;}
        .modal-content {background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; animation: modalPop 0.3s;}
        @keyframes modalPop {from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;}}
        .modal-icon {font-size: 60px; margin-bottom: 15px; text-align: center;}
        .modal-title {font-size: 22px; font-weight: bold; color: #667eea; margin-bottom: 15px; text-align: center;}
        .modal-text {font-size: 15px; color: #666; margin-bottom: 20px; line-height: 1.5; text-align: center;}
        .feedback-field {margin-bottom: 20px;}
        .feedback-field label {display: block; font-weight: bold; color: #333; margin-bottom: 8px; font-size: 14px;}
        .slider-container {display: flex; align-items: center; gap: 10px;}
        .slider {flex: 1; height: 6px; border-radius: 3px; background: #e0e0e0; outline: none; -webkit-appearance: none;}
        .slider::-webkit-slider-thumb {-webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer;}
        .slider::-moz-range-thumb {width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; border: none;}
        .slider-value {font-weight: bold; color: #667eea; min-width: 35px; text-align: center;}
        .feedback-textarea {width: 100%; min-height: 100px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 13px; resize: vertical;}
        .char-counter {font-size: 11px; color: #999; margin-top: 5px; text-align: right;}
        .char-counter.valid {color: #51cf66;}
        .char-counter.invalid {color: #ff6b6b;}
        .export-buttons {display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;}
        /* üÜï NOUVEAU: Styles pour protocoles thermiques */
        .thermal-protocol {background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-radius: 15px; padding: 15px; margin: 15px 0; color: white;}
        .thermal-step {background: rgba(255,255,255,0.95); color: #333; padding: 12px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .thermal-timing {display: inline-block; background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; margin-right: 10px;}
        .mcgill-exercise {background: #e8f5e9; border-left: 4px solid #51cf66; padding: 12px; margin: 10px 0; border-radius: 8px;}
        /* FIN üÜï */
        @media (max-width: 600px) {
            .container {padding: 12px;}
            h1 {font-size: 22px;}
            .timer-display {font-size: 36px;}
            .exercise-header {flex-direction: column; align-items: flex-start;}
            .demo-btn {width: 100%; margin-top: 5px;}
            .auto-save-indicator {top: 10px; right: 10px; font-size: 11px; padding: 6px 12px;}
            .export-buttons {grid-template-columns: 1fr;}
        }
    </style>
</head>
<body>
    <div class="auto-save-indicator" id="auto-save-indicator">‚úÖ Sauvegard√©</div>

    <!-- üÜï NOUVEAU: Timer flottant persistant -->
    <div class="floating-timer" id="floating-timer">
        <div class="floating-timer-title" id="floating-timer-title">‚è±Ô∏è REPOS</div>
        <div class="floating-timer-display" id="floating-timer-display">00:00</div>
        <div class="floating-timer-controls">
            <button onclick="floatingTimerAdd30()">+30s</button>
            <button onclick="floatingTimerStop()">Stop</button>
        </div>
    </div>

    <!-- üÜï NOUVEAU: Guide de transition automatique -->
    <div class="transition-guide" id="transition-guide">
        <div class="transition-guide-title">‚úÖ S√©rie termin√©e !</div>
        <div style="margin: 15px 0; color: #666;">Que veux-tu faire ?</div>
        <div class="transition-guide-buttons">
            <button class="btn btn-success" onclick="startRestTimer()">‚è±Ô∏è Repos <span id="suggested-rest-time">90s</span></button>
            <button class="btn btn-primary" onclick="goToNextSet()">‚û°Ô∏è S√©rie suivante</button>
        </div>
    </div>

    <div class="container">
        <h1>üí™ MASSE BUILDER</h1>
        <div style="text-align: center;"><span class="version-badge">v3.2 ULTIMATE ‚Ä¢ 10 Semaines ‚Ä¢ UX Optimis√©e</span></div> <!-- üÜï v3.2: Auto-save + Timer flottant + Guidage + Toggle -->
        <div class="header-info">10 semaines ‚Ä¢ 3 s√©ances/semaine ‚Ä¢ Phase S√®che ‚Ä¢ McGill Big 3</div> <!-- üÜï NOUVEAU: McGill -->

        <div class="week-tracker">
            <div style="font-size: 14px; margin-bottom: 5px;">üìÖ PROGRESSION</div>
            <div class="week-display" id="week-display">SEMAINE 1 / 10</div>
            <div class="week-controls">
                <button class="btn btn-secondary" onclick="changeWeek(-1)">‚óÄÔ∏è S-1</button>
                <button class="btn btn-secondary" onclick="changeWeek(1)">S+1 ‚ñ∂Ô∏è</button>
                <button class="btn btn-primary" onclick="resetWeek()">Reset S1</button>
            </div>
        </div>

        <div class="session-timer" id="session-timer" style="display: none;">
            <div>‚è±Ô∏è DUR√âE S√âANCE</div>
            <div class="session-timer-display" id="session-timer-display">00:00</div>
            <div class="session-controls">
                <button class="btn btn-secondary" onclick="pauseSessionTimer()" id="pause-session-btn">‚è∏ Pause</button>
                <button class="btn btn-primary" onclick="endSession()">‚úÖ Terminer & Exporter</button>
            </div>
            <div style="font-size: 11px; margin-top: 8px; color: #666;">üí° Le timer continue m√™me si tu changes d'app (si autoris√©)</div>
        </div>
        
        <div class="notification-setup">
            <h3>üîî Rappels Training</h3>
            <p style="margin: 8px 0;">Active les notifications pour tes rappels</p>
            <button class="btn btn-primary" onclick="setupNotifications()">‚úÖ Activer notifications</button>
            <div id="notif-status"></div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('lundi')">üî¥ LUN</button>
            <button class="tab" onclick="showTab('mercredi')">üîµ MER</button>
            <button class="tab" onclick="showTab('vendredi')">üü¢ VEN</button>
            <button class="tab" onclick="showTab('recup')">üî• R√âCUP</button> <!-- üÜï NOUVEAU: Tab r√©cup√©ration -->
            <button class="tab" onclick="showTab('progression')">üìä SUIVI</button>
            <button class="tab" onclick="showTab('evolution')">üìà 10 SEM</button>
        </div>
        
        <div class="timer">
            <div style="font-size: 13px; margin-bottom: 5px;">‚è±Ô∏è TIMER REPOS</div>
            <div class="timer-display" id="timer-display">00:00</div>
            <div class="timer-controls">
                <button class="btn btn-secondary" onclick="startTimer(60)">60s</button>
                <button class="btn btn-secondary" onclick="startTimer(90)">90s</button>
                <button class="btn btn-secondary" onclick="startTimer(120)">2min</button>
                <button class="btn btn-secondary" onclick="startTimer(180)">3min</button>
                <button class="btn btn-primary" onclick="stopTimer()">‚èπ Stop</button>
            </div>
        </div>
        
        <!-- LUNDI -->
        <div id="tab-lundi" class="tab-content active">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üî¥ LUNDI - PUSH + √âPAULES PRIORIT√â</h2>

            <div class="workout-section warmup">
                <h3>üî• √âCHAUFFEMENT <span id="warmup-mode-lundi">COMPLET (28 min)</span></h3>

                <!-- üÜï NOUVEAU: Toggle √©chauffement optimal/complet -->
                <div class="warmup-toggle">
                    <div>
                        <div class="warmup-toggle-label">Mode Optimal 15min</div>
                        <div style="font-size: 11px; color: #666;">McGill Big 3 + Activation essentielle</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="warmup-toggle-lundi" onchange="toggleWarmupMode('lundi')">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- üÜï NOUVEAU: McGill Big 3 -->
                <div style="background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #51cf66; margin-bottom: 10px;">üíö McGILL BIG 3 (8 min) - CORE STABILITY</h4>
                    
                    <div class="mcgill-exercise">
                        <strong>1. CURL-UP McGill</strong> 
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=2_e4I-brfqs')" style="margin-left: 10px;">üìπ D√©mo</button>
                        <ul style="font-size: 12px; margin-top: 8px;">
                            <li>Position: Allong√©, 1 jambe pli√©e, mains sous dos</li>
                            <li>D√©coller √©paules 2-3cm SEULEMENT</li>
                            <li>HOLD 10s √ó 3 reps/c√¥t√©</li>
                            <li>‚ö†Ô∏è PAS de crunch classique!</li>
                        </ul>
                    </div>
                    
                    <div class="mcgill-exercise">
                        <strong>2. SIDE PLANK (Gainage lat√©ral)</strong>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=K2VljzCC16g')" style="margin-left: 10px;">üìπ D√©mo</button>
                        <ul style="font-size: 12px; margin-top: 8px;">
                            <li>Sur coude, corps align√©, hanches HAUTES</li>
                            <li>Sem 1-4: 5√ó10s/c√¥t√©</li>
                            <li>Sem 5-8: 4√ó15s/c√¥t√©</li>
                            <li>Sem 9+: 3√ó20s/c√¥t√©</li>
                        </ul>
                    </div>
                    
                    <div class="mcgill-exercise">
                        <strong>3. BIRD-DOG</strong>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=wiFNA3sqjCA')" style="margin-left: 10px;">üìπ D√©mo</button>
                        <ul style="font-size: 12px; margin-top: 8px;">
                            <li>4 pattes, dos NEUTRE</li>
                            <li>Bras + jambe oppos√©e √©tendus</li>
                            <li>HOLD 10s √ó 5 reps/c√¥t√©</li>
                            <li>Colonne ne bouge PAS</li>
                        </ul>
                    </div>
                </div>
                <!-- FIN McGill üÜï -->
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 1: Cardio l√©ger (5 min)</h4>
                <ul>
                    <li>V√©lo/rameur l√©ger 5 min (FC 120-130)</li>
                </ul>
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 2: Mobilit√© articulaire (5 min)</h4>
                <ul>
                    <li>Rotations bras 20 reps</li>
                    <li>Band pull-aparts 2√ó20</li>
                    <li>Dislocations √©paules 2√ó15</li>
                    <li>Wall slides 2√ó10</li>
                    <li>Scapular push-ups 2√ó10</li>
                </ul>
                
                <!-- üÜï NOUVEAU: Phases optionnelles (cach√©es en mode optimal) -->
                <div class="warmup-extended-lundi">
                    <!-- üÜï NOUVEAU: Phase 3 pr√©-activation -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 3: Pr√©-activation PUSH (5 min)</h4>
                    <ul>
                        <li>√âcart√©s c√¢ble l√©ger: 2√ó20 (pecs)</li>
                        <li>√âl√©vations lat√©rales 2kg: 2√ó20 (√©paules)</li>
                        <li>Extensions triceps l√©ger: 2√ó20</li>
                    </ul>

                    <!-- üÜï NOUVEAU: Phase 4 mont√©e progressive -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 4: Mont√©e progressive (5 min)</h4>
                    <ul>
                        <li>D√©velopp√© inclin√© vide √ó 15 reps</li>
                        <li>D√©velopp√© inclin√© 10kg √ó 12 reps (30% charge)</li>
                        <li>D√©velopp√© inclin√© 15kg √ó 10 reps (50% charge)</li>
                        <li>D√©velopp√© inclin√© 20kg √ó 8 reps (70% charge)</li>
                    </ul>
                </div>
                <!-- FIN phases √©chauffement üÜï -->
            </div>
            
            <div class="workout-section">
                <h3>üî• BLOC 1 - √âPAULES (PRIORIT√â)</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">1. √âl√©vations lat√©rales halt√®res</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=3VcKaXpzqRo')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-lun-elev">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-lun-1"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 4√ó12</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 8kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-1-2-1</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                        <div class="detail-item"><span class="detail-label">Progression:</span> +1kg/2sem</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ FOCUS:</strong> SQUEEZE delto√Ødes ‚Ä¢ PAS balancer ‚Ä¢ Contraction pic 1s</div>
                    <div class="movement-diagram">‚¨ÜÔ∏è 2s mont√©e ‚Üí üí™ SQUEEZE 1s ‚Üí ‚¨áÔ∏è 2s descente</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1 (kg√óreps)</label><input type="text" id="lun-1-s1" data-exercise="lun-1" data-target="12" placeholder="8√ó12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-1-s2" data-exercise="lun-1" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-1-s3" data-exercise="lun-1" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="lun-1-s4" data-exercise="lun-1" data-target="12" oninput="handleInput(this)"></div>
                    </div>
                </div>

                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">2. Face pull poulie haute</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=rep-qVOkqgk')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-lun-face">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-lun-2"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 4√ó15</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 20kg</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                        <div class="detail-item"><span class="detail-label">Progression:</span> +2.5kg/2sem</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ FOCUS:</strong> Coudes HAUTS ‚Ä¢ Squeeze delto√Ødes post</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="lun-2-s1" data-exercise="lun-2" data-target="15" placeholder="20√ó15" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-2-s2" data-exercise="lun-2" data-target="15" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-2-s3" data-exercise="lun-2" data-target="15" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="lun-2-s4" data-exercise="lun-2" data-target="15" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üí™ BLOC 2 - PECS & √âPAULES</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">3. D√©velopp√© inclin√© halt√®res 30¬∞</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=8iPEnn-ltC8')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-lun-incline">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-lun-3"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 5√ó8</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 28kg</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 3min</div>
                        <div class="detail-item"><span class="detail-label">RPE:</span> 7-8</div>
                    </div>
                    <div class="exercise-visual"><strong>‚ö†Ô∏è S√àCHE:</strong> D√©marrer SOUS max ‚Ä¢ Objectif = MAINTIEN force</div>
                    <div class="movement-diagram">‚¨áÔ∏è 3s lent ‚Üí üí• 2s mont√©e ‚Üí üí™ Squeeze</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1 (kg√óreps)</label><input type="text" id="lun-3-s1" data-exercise="lun-3" data-target="8" placeholder="28√ó8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-3-s2" data-exercise="lun-3" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-3-s3" data-exercise="lun-3" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="lun-3-s4" data-exercise="lun-3" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S5</label><input type="text" id="lun-3-s5" data-exercise="lun-3" data-target="8" oninput="handleInput(this)"></div>
                    </div>
                </div>

                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">4. D√©velopp√© Arnold</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=6Z15_WdXmVw')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-lun-4"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó10</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 16kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> Contr√¥l√©</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 2min</div>
                    </div>
                    <div class="movement-diagram">üîÑ Paumes vers toi ‚Üí üîÑ Pivoter ‚Üí üôå Finir devant</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="lun-4-s1" data-exercise="lun-4" data-target="10" placeholder="16√ó10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-4-s2" data-exercise="lun-4" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-4-s3" data-exercise="lun-4" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üí• BLOC 3 - TRICEPS</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">5. Dips (assist√©s ou lest√©s)</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=2z8JmcrW-As')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-lun-5"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó10</div>
                        <div class="detail-item"><span class="detail-label">Assistance:</span> Variable</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-0-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 2min</div>
                    </div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="lun-5-s1" data-exercise="lun-5" data-target="10" placeholder="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-5-s2" data-exercise="lun-5" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-5-s3" data-exercise="lun-5" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">6. Extension triceps c√¢ble</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=kiuVA0gs3EI')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-lun-6"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó12</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> Pile 6</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 1-1-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> Corde ‚Ä¢ Extension compl√®te ‚Ä¢ Coudes fixes</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="lun-6-s1" data-exercise="lun-6" data-target="12" placeholder="P6√ó12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="lun-6-s2" data-exercise="lun-6" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="lun-6-s3" data-exercise="lun-6" data-target="12" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <!-- üÜï NOUVEAU: Protocole thermique post-workout -->
            <div class="thermal-protocol">
                <h3 style="color: white;">üî• POST-WORKOUT: Protocole Anti-inflammatoire (16h30)</h3>
                <p style="margin: 10px 0; font-size: 13px;">‚è±Ô∏è Dur√©e totale: 35 min ‚Ä¢ üéØ Objectif: -40% douleurs</p>
                <button class="btn btn-primary" onclick="showThermalProtocol('lundi')">Voir protocole d√©taill√©</button>
            </div>
            <!-- FIN protocole thermique üÜï -->
            
            <textarea class="notes-area" id="notes-lundi" placeholder="üìù Notes: √©nergie /10, douleurs..." oninput="autoSave()"></textarea>
        </div>
        
        <!-- MERCREDI -->
        <div id="tab-mercredi" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üîµ MERCREDI - PULL</h2>

            <div class="workout-section warmup">
                <h3>üî• √âCHAUFFEMENT <span id="warmup-mode-mercredi">COMPLET (28 min)</span></h3>

                <!-- üÜï NOUVEAU: Toggle √©chauffement optimal/complet -->
                <div class="warmup-toggle">
                    <div>
                        <div class="warmup-toggle-label">Mode Optimal 15min</div>
                        <div style="font-size: 11px; color: #666;">McGill Big 3 + Activation essentielle</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="warmup-toggle-mercredi" onchange="toggleWarmupMode('mercredi')">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- üÜï NOUVEAU: McGill Big 3 -->
                <div style="background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #51cf66; margin-bottom: 10px;">üíö McGILL BIG 3 (8 min) - CORE STABILITY</h4>
                    <p style="font-size: 12px; color: #666;">M√™me protocole qu'au Lundi (voir d√©tails dans l'onglet Lundi)</p>
                </div>
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 1: Cardio (5 min)</h4>
                <ul>
                    <li>Rameur l√©ger 5 min</li>
                </ul>
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 2: Mobilit√© (5 min)</h4>
                <ul>
                    <li>Cat-cow 20 reps</li>
                    <li>Thread the needle 10/c√¥t√©</li>
                    <li>Band rows 2√ó20</li>
                    <li>Scapular pull-ups 2√ó8</li>
                    <li>Dead hangs 2√ó30s</li>
                </ul>
                
                <!-- üÜï NOUVEAU: Phases optionnelles (cach√©es en mode optimal) -->
                <div class="warmup-extended-mercredi">
                    <!-- üÜï NOUVEAU: Phase 3 pr√©-activation -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 3: Pr√©-activation PULL (5 min)</h4>
                    <ul>
                        <li>Pull-overs l√©ger: 2√ó20 (lats)</li>
                        <li>Band rows: 2√ó20 (dorsaux)</li>
                        <li>Curl l√©ger: 2√ó20 (biceps)</li>
                    </ul>

                    <!-- üÜï NOUVEAU: Phase 4 mont√©e progressive -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 4: Mont√©e progressive (5 min)</h4>
                    <ul>
                        <li>Tirage poulie l√©ger √ó 15 reps</li>
                        <li>Tirage 30% charge √ó 12 reps</li>
                        <li>Tirage 50% charge √ó 10 reps</li>
                        <li>Tirage 70% charge √ó 8 reps</li>
                    </ul>
                </div>
                <!-- FIN phases √©chauffement üÜï -->
            </div>
            
            <div class="workout-section">
                <h3>üí™ BLOC 1 - LARGEUR</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">1. Tractions (assist√©es progression)</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=eGo4IYlbE5g')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-mer-tractions">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-mer-1"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 5√ó5</div>
                        <div class="detail-item"><span class="detail-label">Assistance S1:</span> -20kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 3-0-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 3min</div>
                    </div>
                    <div class="exercise-visual"><strong>üìä PROGRESSION:</strong> S1-3: -20kg ‚Ä¢ S4-6: -15kg ‚Ä¢ S7-9: -10kg ‚Ä¢ S10: -5kg</div>
                    <div class="movement-diagram">‚¨áÔ∏è 3s descente ‚Üí ‚¨ÜÔ∏è 2s coudes vers BAS</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="mer-1-s1" data-exercise="mer-1" data-target="5" placeholder="5" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="mer-1-s2" data-exercise="mer-1" data-target="5" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="mer-1-s3" data-exercise="mer-1" data-target="5" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="mer-1-s4" data-exercise="mer-1" data-target="5" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S5</label><input type="text" id="mer-1-s5" data-exercise="mer-1" data-target="5" oninput="handleInput(this)"></div>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">2. Rowing barre (pronation)</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=kBWAon7ItDw')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-mer-rowing">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-mer-2"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 5√ó8</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 50kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-1-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 3min</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ FOCUS:</strong> Coudes le long du corps ‚Ä¢ +2.5kg/2sem</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="mer-2-s1" data-exercise="mer-2" data-target="8" placeholder="50√ó8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="mer-2-s2" data-exercise="mer-2" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="mer-2-s3" data-exercise="mer-2" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="mer-2-s4" data-exercise="mer-2" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S5</label><input type="text" id="mer-2-s5" data-exercise="mer-2" data-target="8" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üèîÔ∏è BLOC 2 - √âPAISSEUR</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">3. Tirage horizontal machine</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=GZbfZ033f74')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-mer-3"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó10</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> Pile 8</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 1-1-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 2min</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> Prise neutre ‚Ä¢ Squeeze scapula</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="mer-3-s1" data-exercise="mer-3" data-target="10" placeholder="P8√ó10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="mer-3-s2" data-exercise="mer-3" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="mer-3-s3" data-exercise="mer-3" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">4. Pull-over poulie</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=J_kUApWkpCs')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-mer-4"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó12</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> Pile 6</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 1-1-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> Bras semi-tendus ‚Ä¢ √âtirement lats</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="mer-4-s1" data-exercise="mer-4" data-target="12" placeholder="P6√ó12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="mer-4-s2" data-exercise="mer-4" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="mer-4-s3" data-exercise="mer-4" data-target="12" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üí• BLOC 3 - BICEPS</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">5. Curl inclin√© halt√®res</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=soxrZlIl35U')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-mer-5"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó10</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 14kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-1-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> Banc 45¬∞ ‚Ä¢ √âtirement maximal</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="mer-5-s1" data-exercise="mer-5" data-target="10" placeholder="14√ó10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="mer-5-s2" data-exercise="mer-5" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="mer-5-s3" data-exercise="mer-5" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <!-- üÜï NOUVEAU: Protocole thermique optionnel -->
            <div class="thermal-protocol" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                <h3 style="color: #333;">üåô SOIR (Optionnel): Protocole D√©tente (20h30)</h3>
                <p style="margin: 10px 0; font-size: 13px; color: #333;">‚è±Ô∏è Dur√©e: 30 min ‚Ä¢ üéØ Objectif: Sommeil +20%</p>
                <button class="btn btn-primary" onclick="showThermalProtocol('mercredi')">Voir protocole d√©taill√©</button>
            </div>
            <!-- FIN protocole thermique üÜï -->
            
            <textarea class="notes-area" id="notes-mercredi" placeholder="üìù Notes s√©ance..." oninput="autoSave()"></textarea>
        </div>
        
        <!-- VENDREDI -->
        <div id="tab-vendredi" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üü¢ VENDREDI - LEGS</h2>

            <div class="workout-section warmup">
                <h3>üî• √âCHAUFFEMENT <span id="warmup-mode-vendredi">COMPLET (28 min)</span></h3>

                <!-- üÜï NOUVEAU: Toggle √©chauffement optimal/complet -->
                <div class="warmup-toggle">
                    <div>
                        <div class="warmup-toggle-label">Mode Optimal 15min</div>
                        <div style="font-size: 11px; color: #666;">McGill Big 3 + Activation essentielle</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="warmup-toggle-vendredi" onchange="toggleWarmupMode('vendredi')">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- üÜï NOUVEAU: McGill Big 3 -->
                <div style="background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #51cf66; margin-bottom: 10px;">üíö McGILL BIG 3 (8 min) - CORE STABILITY</h4>
                    <p style="font-size: 12px; color: #666;">M√™me protocole qu'au Lundi (voir d√©tails dans l'onglet Lundi)</p>
                </div>
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 1: Cardio (5 min)</h4>
                <ul>
                    <li>V√©lo 5 min</li>
                </ul>
                
                <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 2: Mobilit√© (5 min)</h4>
                <ul>
                    <li>90/90 hip transitions 2x8</li>
                    <li>Glute bridge 2√ó20</li>
                    <li>Deep squat hold 2√ó30s</li>
                    <li>Foam roll IT band 2 min/jambe</li>
                    <li>Foam roll quadriceps 2 min</li>
                    <li>Foam roll fessiers 2 min/c√¥t√©</li>
                </ul>
                
                <!-- üÜï NOUVEAU: Phases optionnelles (cach√©es en mode optimal) -->
                <div class="warmup-extended-vendredi">
                    <!-- üÜï NOUVEAU: Phase 3 pr√©-activation -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 3: Pr√©-activation LEGS (5 min)</h4>
                    <ul>
                        <li>Goblet squat vide: 2√ó15</li>
                        <li>Hip thrust bodyweight: 2√ó20</li>
                        <li>Leg extension l√©ger: 2√ó20</li>
                    </ul>

                    <!-- üÜï NOUVEAU: Phase 4 mont√©e progressive -->
                    <h4 style="color: #ffa500; margin: 15px 0 10px 0;">üî∏ PHASE 4: Mont√©e progressive RDL (5 min)</h4>
                    <ul>
                        <li>RDL barre vide √ó 15 reps</li>
                        <li>RDL 30% charge √ó 12 reps</li>
                        <li>RDL 50% charge √ó 10 reps</li>
                        <li>RDL 70% charge √ó 8 reps</li>
                    </ul>
                </div>
                <!-- FIN phases √©chauffement üÜï -->
            </div>
            
            <div class="workout-section">
                <h3>üí™ BLOC 1 - CHA√éNE POST</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">1. Romanian Deadlift</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=2SHsk9AzdjA')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-ven-rdl">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-ven-1"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 5√ó8</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 50kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 3-0-2-1</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 3min</div>
                        <div class="detail-item"><span class="detail-label">RPE:</span> 7-8</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ FOCUS:</strong> Hanche arri√®re ‚Ä¢ Dos neutre ‚Ä¢ +5kg/2sem</div>
                    <div class="movement-diagram">‚¨áÔ∏è 3s stretch ischio ‚Üí üçë Squeeze fessiers ‚Üí ‚¨ÜÔ∏è 2s</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="ven-1-s1" data-exercise="ven-1" data-target="8" placeholder="50√ó8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="ven-1-s2" data-exercise="ven-1" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="ven-1-s3" data-exercise="ven-1" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="ven-1-s4" data-exercise="ven-1" data-target="8" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S5</label><input type="text" id="ven-1-s5" data-exercise="ven-1" data-target="8" oninput="handleInput(this)"></div>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">2. Hip thrust barre</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=xDmFkJxPzeM')">üìπ D√©mo</button>
                    </div>
                    <div class="last-week-data" id="lastweek-ven-hip">üíæ Semaine derni√®re: Chargement...</div>
                    <div class="performance-analysis" id="analysis-ven-2"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 4√ó12</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 30kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 1-2-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 2min</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> Contraction 2s en haut ‚Ä¢ +5kg/2sem</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="ven-2-s1" data-exercise="ven-2" data-target="12" placeholder="30√ó12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="ven-2-s2" data-exercise="ven-2" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="ven-2-s3" data-exercise="ven-2" data-target="12" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="ven-2-s4" data-exercise="ven-2" data-target="12" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üèîÔ∏è BLOC 2 - QUADRICEPS</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">3. Goblet squat</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=MeIiIdhvXT4')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-ven-3"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 4√ó10</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 20kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-0-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 2min</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> ATG (ass to grass) ‚Ä¢ +2kg/2sem</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="ven-3-s1" data-exercise="ven-3" data-target="10" placeholder="20√ó10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="ven-3-s2" data-exercise="ven-3" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="ven-3-s3" data-exercise="ven-3" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="ven-3-s4" data-exercise="ven-3" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üí• BLOC 3 - ISOLATION</h3>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">4. Fentes bulgares</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=2C-uNgKwPLE')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-ven-4"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 3√ó10/jambe</div>
                        <div class="detail-item"><span class="detail-label">Charge S1:</span> 10kg</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-0-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 90s</div>
                    </div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1 (D/G)</label><input type="text" id="ven-4-s1" data-exercise="ven-4" data-target="10" placeholder="10√ó10/10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="ven-4-s2" data-exercise="ven-4" data-target="10" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="ven-4-s3" data-exercise="ven-4" data-target="10" oninput="handleInput(this)"></div>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-header">
                        <div class="exercise-title">5. Mollets debout</div>
                        <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=JbyjNymZOJo')">üìπ D√©mo</button>
                    </div>
                    <div class="performance-analysis" id="analysis-ven-5"></div>
                    <div class="exercise-details">
                        <div class="detail-item"><span class="detail-label">S√©ries:</span> 4√ó20</div>
                        <div class="detail-item"><span class="detail-label">Tempo:</span> 2-2-2</div>
                        <div class="detail-item"><span class="detail-label">Repos:</span> 60s</div>
                    </div>
                    <div class="exercise-visual"><strong>üéØ ASTUCE:</strong> √âtirement + contraction compl√®te</div>
                    <div class="sets-tracker">
                        <div class="set-input"><label>S1</label><input type="text" id="ven-5-s1" data-exercise="ven-5" data-target="20" placeholder="20" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S2</label><input type="text" id="ven-5-s2" data-exercise="ven-5" data-target="20" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S3</label><input type="text" id="ven-5-s3" data-exercise="ven-5" data-target="20" oninput="handleInput(this)"></div>
                        <div class="set-input"><label>S4</label><input type="text" id="ven-5-s4" data-exercise="ven-5" data-target="20" oninput="handleInput(this)"></div>
                    </div>
                </div>
            </div>
            
            <!-- üÜï NOUVEAU: Protocole thermique post-workout -->
            <div class="thermal-protocol">
                <h3 style="color: white;">üî• POST-WORKOUT: Protocole Anti-inflammatoire (16h30)</h3>
                <p style="margin: 10px 0; font-size: 13px;">‚è±Ô∏è Dur√©e totale: 35 min ‚Ä¢ üéØ Objectif: -40% douleurs</p>
                <button class="btn btn-primary" onclick="showThermalProtocol('vendredi')">Voir protocole d√©taill√©</button>
            </div>
            <!-- FIN protocole thermique üÜï -->
            
            <textarea class="notes-area" id="notes-vendredi" placeholder="üìù Notes (genou ?)..." oninput="autoSave()"></textarea>
        </div>
        
        <!-- üÜï NOUVEAU: Tab R√âCUP√âRATION -->
        <div id="tab-recup" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üî• PROTOCOLES THERMIQUES</h2>
            
            <div class="workout-section">
                <h3>üíö McGILL BIG 3 - QUOTIDIEN</h3>
                <p style="color: #666; margin-bottom: 15px;">üìÖ √Ä faire 6√ó/semaine ‚Ä¢ ‚è±Ô∏è 8 minutes ‚Ä¢ üéØ Matin OU pr√©-training</p>
                
                <div class="mcgill-exercise">
                    <strong>1. CURL-UP McGILL (3√ó10s hold/c√¥t√©)</strong>
                    <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=2_e4I-brfqs')" style="margin-left: 10px;">üìπ D√©mo</button>
                    <ul style="margin-top: 10px;">
                        <li>Allong√© dos, une jambe pli√©e, une tendue</li>
                        <li>Mains sous bas dos (pr√©serve courbe naturelle)</li>
                        <li>T√™te/√©paules d√©collent 2-3 cm SEULEMENT</li>
                        <li>Regard vers plafond (cou neutre)</li>
                        <li>HOLD 10 secondes</li>
                        <li>Respiration normale (pas bloqu√©e)</li>
                    </ul>
                    <div style="background: #fff3cd; padding: 8px; margin-top: 10px; border-radius: 6px; font-size: 12px;">
                        ‚ö†Ô∏è <strong>IMPORTANT:</strong> PAS de crunch classique! Active le transverse sans fl√©chir la colonne
                    </div>
                </div>
                
                <div class="mcgill-exercise">
                    <strong>2. SIDE PLANK (Progression)</strong>
                    <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=K2VljzCC16g')" style="margin-left: 10px;">üìπ D√©mo</button>
                    <ul style="margin-top: 10px;">
                        <li>Sur coude, corps align√©</li>
                        <li>Hanches HAUTES (pas affaiss√©es)</li>
                        <li>Main libre sur hanche oppos√©e</li>
                    </ul>
                    <div style="background: #e8f5e9; padding: 10px; margin-top: 10px; border-radius: 6px;">
                        <strong>üìä Progression:</strong><br>
                        ‚Ä¢ Sem 1-4: 5√ó10s/c√¥t√©<br>
                        ‚Ä¢ Sem 5-8: 4√ó15s/c√¥t√©<br>
                        ‚Ä¢ Sem 9+: 3√ó20s/c√¥t√©
                    </div>
                </div>
                
                <div class="mcgill-exercise">
                    <strong>3. BIRD-DOG (5√ó10s hold/c√¥t√©)</strong>
                    <button class="demo-btn" onclick="openDemo('https://www.youtube.com/watch?v=wiFNA3sqjCA')" style="margin-left: 10px;">üìπ D√©mo</button>
                    <ul style="margin-top: 10px;">
                        <li>4 pattes, dos NEUTRE (pas cambr√©/rond)</li>
                        <li>√âtends bras + jambe oppos√©e</li>
                        <li>HOLD 10 secondes</li>
                        <li>Contr√¥le: colonne ne bouge PAS</li>
                    </ul>
                </div>
            </div>
            
            <div class="thermal-protocol">
                <h3 style="color: white;">üî• LUNDI & VENDREDI - Protocole Anti-Inflammatoire (16h30)</h3>
                
                <div class="thermal-step">
                    <span class="thermal-timing">20 min</span>
                    <strong>1. SAUNA TH√âRAPEUTIQUE</strong>
                    <ul style="margin-top: 8px;">
                        <li>üî• 85¬∞C</li>
                        <li>‚è±Ô∏è 2 sessions de 10 min</li>
                        <li>ü™£ Loyly mod√©r√© (3-4 louches)</li>
                        <li>üíß Pause hydratation entre sessions</li>
                    </ul>
                </div>
                
                <div class="thermal-step">
                    <span class="thermal-timing">3 min</span>
                    <strong>2. PISCINE FROIDE</strong>
                    <ul style="margin-top: 8px;">
                        <li>‚ùÑÔ∏è Focus articulations douloureuses</li>
                        <li>üí™ Mouvements doux dans l'eau</li>
                        <li>üßä Immersion progressive</li>
                    </ul>
                </div>
                
                <div class="thermal-step">
                    <span class="thermal-timing">10 min</span>
                    <strong>3. SPA TH√âRAPEUTIQUE</strong>
                    <ul style="margin-top: 8px;">
                        <li>üå°Ô∏è 40¬∞C</li>
                        <li>üíÜ Jets sur articulations</li>
                        <li>üéØ Focus: √âpaules, genoux, coudes, dos</li>
                    </ul>
                </div>
                
                <div style="background: white; padding: 10px; margin-top: 15px; border-radius: 8px;">
                    <strong>üìä R√âSULTATS ATTENDUS:</strong><br>
                    ‚Ä¢ Douleur articulaire: -40%<br>
                    ‚Ä¢ R√©cup√©ration musculaire: +35%<br>
                    ‚Ä¢ Inflammation syst√©mique: -30%
                </div>
            </div>
            
            <div class="thermal-protocol" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); margin-top: 20px;">
                <h3 style="color: #333;">üåô MERCREDI - Protocole D√©tente (20h30) - OPTIONNEL</h3>
                
                <div class="thermal-step">
                    <span class="thermal-timing">15 min</span>
                    <strong>1. SPA/JACUZZI RELAXATION</strong>
                    <ul style="margin-top: 8px;">
                        <li>üå°Ô∏è 38-40¬∞C</li>
                        <li>üíÜ Jets l√©gers partout</li>
                        <li>üßò Relaxation compl√®te</li>
                        <li>üì± Musique calme, pas d'√©cran</li>
                    </ul>
                </div>
                
                <div class="thermal-step">
                    <span class="thermal-timing">2-3 min</span>
                    <strong>2. PISCINE FROIDE</strong>
                    <ul style="margin-top: 8px;">
                        <li>‚ùÑÔ∏è Immersion compl√®te</li>
                        <li>üß† Contraste final pour sommeil</li>
                    </ul>
                </div>
                
                <div class="thermal-step">
                    <span class="thermal-timing">10 min</span>
                    <strong>3. SAUNA DOUX (OPTIONNEL)</strong>
                    <ul style="margin-top: 8px;">
                        <li>üî• 75-80¬∞C (moins intense)</li>
                        <li>ü™£ Loyly l√©ger (1-2 louches)</li>
                    </ul>
                </div>
                
                <div class="thermal-step">
                    <strong>4. ROUTINE POST-PROTOCOLE</strong>
                    <ul style="margin-top: 8px;">
                        <li>üöø Douche ti√®de</li>
                        <li>üëï V√™tements confort</li>
                        <li>üíß Hydratation</li>
                        <li>üìñ Lecture (pas √©cran)</li>
                    </ul>
                </div>
                
                <div style="background: white; padding: 10px; margin-top: 15px; border-radius: 8px;">
                    <strong>üìä R√âSULTATS ATTENDUS:</strong><br>
                    ‚Ä¢ Qualit√© sommeil: +20%<br>
                    ‚Ä¢ Temps endormissement: -50%<br>
                    ‚Ä¢ Stress cortisol: -25%
                </div>
            </div>
            
            <div class="workout-section" style="margin-top: 20px;">
                <h3>üìÖ PLANNING HEBDO OPTIMAL</h3>
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <tr style="background: #667eea; color: white;">
                        <th style="padding: 8px; border: 1px solid #ddd;">Jour</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Matin</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Training</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Post-workout</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Soir</th>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Lundi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Push + √âpaules</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #ffe8cc;">Protocole Anti-inflam</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Mardi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Repos</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Mercredi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Pull</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #e8f5e9;">D√©tente (option)</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Jeudi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Repos</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Vendredi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Legs</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #ffe8cc;">Protocole Anti-inflam</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Samedi</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">McGill Big 3</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Repos actif</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;"><strong>Dimanche</strong></td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Repos McGill</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Repos total</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">-</td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- FIN tab r√©cup√©ration üÜï -->
        
        <!-- SUIVI PROGRESSION -->
        <div id="tab-progression" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üìä SUIVI</h2>
            
            <div class="workout-section">
                <h3>üì∏ SUIVI PHOTOS</h3>
                <div id="photo-reminder"></div>
                
                <div class="photo-upload-section">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üì∑ Photos Semaine <span id="current-photo-week">1</span></h4>
                    <div class="photo-grid">
                        <div class="photo-item" onclick="uploadPhoto('face')">
                            <div class="photo-placeholder" id="placeholder-face"><div style="font-size: 30px;">üì∑</div><div>FACE</div></div>
                            <img id="photo-face" style="display: none;">
                            <button class="photo-delete" onclick="deletePhoto('face', event)">√ó</button>
                        </div>
                        <div class="photo-item" onclick="uploadPhoto('dos')">
                            <div class="photo-placeholder" id="placeholder-dos"><div style="font-size: 30px;">üì∑</div><div>DOS</div></div>
                            <img id="photo-dos" style="display: none;">
                            <button class="photo-delete" onclick="deletePhoto('dos', event)">√ó</button>
                        </div>
                        <div class="photo-item" onclick="uploadPhoto('profil')">
                            <div class="photo-placeholder" id="placeholder-profil"><div style="font-size: 30px;">üì∑</div><div>PROFIL</div></div>
                            <img id="photo-profil" style="display: none;">
                            <button class="photo-delete" onclick="deletePhoto('profil', event)">√ó</button>
                        </div>
                    </div>
                    <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoUpload()">
                    
                    <div class="export-buttons">
                        <button class="btn btn-success" onclick="analyzePhotosWithAI()">ü§ñ Analyser avec IA</button>
                    </div>
                </div>
                
                <div class="photo-upload-section" style="margin-top: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üìä Comparaison Transformation</h4>
                    <div class="photo-comparison" id="photo-comparison">
                        <p style="color: #999; text-align: center;">Prends tes premi√®res photos pour voir ta progression !</p>
                    </div>
                </div>
            </div>
            
            <div class="workout-section">
                <h3>üìè Mesures</h3>
                <div class="progress-item"><span>Poids (kg)</span><input type="text" id="prog-poids" placeholder="93" oninput="saveProgressData()"></div>
                <div class="progress-item"><span>Tour taille (cm)</span><input type="text" id="prog-taille" placeholder="102" oninput="saveProgressData()"></div>
            </div>
            
            <div class="workout-section">
                <h3>üí™ Charges cl√©s</h3>
                <div class="progress-item"><span>Inclin√© HB (kg)</span><input type="text" id="prog-incline" placeholder="28" oninput="saveProgressData()"></div>
                <div class="progress-item"><span>Tractions (reps)</span><input type="text" id="prog-tractions" placeholder="5" oninput="saveProgressData()"></div>
                <div class="progress-item"><span>RDL (kg)</span><input type="text" id="prog-rdl" placeholder="50" oninput="saveProgressData()"></div>
            </div>
            
            <div class="workout-section">
                <h3>üìù Historique</h3>
                <div id="workout-history"><p style="color: #999;">Aucune s√©ance</p></div>
                <div class="export-buttons" style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="exportReport()">üìã Copier rapport</button>
                    <button class="btn btn-secondary" onclick="emailCoach()">üìß Email coach</button>
                </div>
            </div>
        </div>

        <!-- √âVOLUTION 10 SEMAINES -->
        <div id="tab-evolution" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 12px; font-size: 20px;">üìà PROGRESSION 10 SEMAINES</h2>
            
            <div class="workout-section">
                <h3>üéØ Vue d'ensemble</h3>
                <div id="week-overview" style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin: 15px 0;">
                    <!-- G√©n√©r√© dynamiquement -->
                </div>
            </div>

            <div class="workout-section">
                <h3>üí™ D√©velopp√© Inclin√© (5√ó8)</h3>
                <table class="progression-table" id="table-incline">
                    <thead>
                        <tr><th>Semaine</th><th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th><th>Moyenne</th><th>Statut</th></tr>
                    </thead>
                    <tbody>
                        <!-- G√©n√©r√© dynamiquement -->
                    </tbody>
                </table>
            </div>

            <div class="workout-section">
                <h3>üèãÔ∏è Romanian Deadlift (5√ó8)</h3>
                <table class="progression-table" id="table-rdl">
                    <thead>
                        <tr><th>Semaine</th><th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th><th>Moyenne</th><th>Statut</th></tr>
                    </thead>
                    <tbody>
                        <!-- G√©n√©r√© dynamiquement -->
                    </tbody>
                </table>
            </div>

            <div class="workout-section">
                <h3>üí™ Tractions Assist√©es (5x5)</h3>
                <table class="progression-table" id="table-tractions">
                    <thead>
                        <tr><th>Semaine</th><th>S1</th><th>S2</th><th>S3</th><th>S4</th><th>S5</th><th>Total</th><th>Statut</th></tr>
                    </thead>
                    <tbody>
                        <!-- G√©n√©r√© dynamiquement -->
                    </tbody>
                </table>
            </div>

            <div class="workout-section">
                <h3>üìä √âvolution Corporelle</h3>
                <table class="progression-table" id="table-body">
                    <thead>
                        <tr><th>Semaine</th><th>Poids (kg)</th><th>Œî vs S0</th><th>Tour taille (cm)</th><th>Œî vs S0</th></tr>
                    </thead>
                    <tbody>
                        <!-- G√©n√©r√© dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal simple de progression -->
    <div class="modal" id="progression-modal">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">üéâ</div>
            <div class="modal-title" id="modal-title">Titre</div>
            <div class="modal-text" id="modal-text">Message</div>
            <button class="btn btn-primary" style="width: 100%;" onclick="closeModal()">OK !</button>
        </div>
    </div>

    <!-- Modal de feedback -->
    <div class="modal" id="feedback-modal">
        <div class="modal-content">
            <div class="modal-icon">üìä</div>
            <div class="modal-title">Feedback S√©ance</div>
            
            <div class="feedback-field">
                <label>√ânergie pr√©-workout</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="energie" min="1" max="10" value="5" oninput="updateSliderValue('energie')">
                    <span class="slider-value" id="energie-value">5/10</span>
                </div>
            </div>
            
            <div class="feedback-field">
                <label>Qualit√© sommeil</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="sommeil" min="1" max="10" value="5" oninput="updateSliderValue('sommeil')">
                    <span class="slider-value" id="sommeil-value">5/10</span>
                </div>
            </div>
            
            <div class="feedback-field">
                <label>Congestion musculaire</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="congestion" min="1" max="10" value="5" oninput="updateSliderValue('congestion')">
                    <span class="slider-value" id="congestion-value">5/10</span>
                </div>
            </div>
            
            <div class="feedback-field">
                <label>Douleurs articulaires</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="douleurs" min="0" max="10" value="0" oninput="updateSliderValue('douleurs')">
                    <span class="slider-value" id="douleurs-value">0/10</span>
                </div>
            </div>
            
            <div class="feedback-field">
                <label>RPE global s√©ance</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="rpe" min="1" max="10" value="5" oninput="updateSliderValue('rpe')">
                    <span class="slider-value" id="rpe-value">5/10</span>
                </div>
            </div>
            
            <div class="feedback-field">
                <label>Notes (min. 20 caract√®res)</label>
                <textarea class="feedback-textarea" id="feedback-notes" placeholder="Excellente s√©ance, bonne congestion..." oninput="updateCharCounter()"></textarea>
                <div class="char-counter" id="char-counter">0/20 caract√®res</div>
            </div>
            
            <div class="export-buttons">
                <button class="btn btn-secondary" onclick="closeFeedbackModal()">Annuler</button>
                <button class="btn btn-primary" id="generate-report-btn" onclick="copyReport()" disabled>üìã Copier</button>
                <button class="btn btn-success" id="open-chatgpt-btn" onclick="openChatGPT()" disabled>ü§ñ ChatGPT</button>
                <button class="btn btn-secondary" id="email-report-btn" onclick="emailReport()" disabled>üìß Email</button>
            </div>
        </div>
    </div>

    <!-- üÜï NOUVEAU: Modal protocole thermique -->
    <div class="modal" id="thermal-protocol-modal">
        <div class="modal-content">
            <div class="modal-icon">üî•</div>
            <div class="modal-title" id="thermal-title">Protocole Thermique</div>
            <div class="modal-text" id="thermal-content"></div>
            <button class="btn btn-primary" style="width: 100%;" onclick="closeThermalModal()">Compris !</button>
        </div>
    </div>
    <!-- FIN modal thermique üÜï -->

    <script>
let timerInterval=null,timeLeft=0,sessionTimerInterval=null,sessionSeconds=0,sessionPaused=false,sessionStartTime=null;
let currentWeek=parseInt(localStorage.getItem('currentWeek')||'1'),autoSaveTimeout=null,currentPhotoType='',wakeLock=null;
let inputStates={};
let generatedReport='';

const baselineProgram={
    'lun-1':{weight:8,reps:12},'lun-2':{weight:20,reps:15},'lun-3':{weight:28,reps:8},'lun-4':{weight:16,reps:10},
    'lun-5':{weight:'',reps:10},'lun-6':{weight:'P6',reps:12},
    'mer-1':{weight:'',reps:5},'mer-2':{weight:50,reps:8},'mer-3':{weight:'P8',reps:10},'mer-4':{weight:'P6',reps:12},
    'mer-5':{weight:14,reps:10},
    'ven-1':{weight:50,reps:8},'ven-2':{weight:30,reps:12},'ven-3':{weight:20,reps:10},'ven-4':{weight:10,reps:10},'ven-5':{weight:'',reps:20}
};

window.onload=function(){updateWeekDisplay();loadAllData();checkPhotoReminders();loadPhotos();updatePhotoComparison();validateFeedbackForm();requestWakeLock()};

async function requestWakeLock(){try{if('wakeLock'in navigator){wakeLock=await navigator.wakeLock.request('screen');wakeLock.addEventListener('release',()=>{console.log('Wake Lock released')});console.log('Wake Lock active')}}catch(err){console.log('Wake Lock not supported:',err)}}

function updateWeekDisplay(){
    document.getElementById('week-display').textContent=`SEMAINE ${currentWeek} / 10`;
    localStorage.setItem('currentWeek',currentWeek);
    if(currentWeek===4||currentWeek===8||currentWeek===10){
        setTimeout(()=>showModal('üìä','Temps de mesurer !',`Fin de semaine ${currentWeek} : Prends tes mesures (poids, tour de taille, photos)`),1000)
    }
    if(currentWeek===7){
        setTimeout(()=>showModal('‚ö†Ô∏è','DELOAD Semaine 7',`Volume -40% ‚Ä¢ Charges maintenues ‚Ä¢ Reps -2 ‚Ä¢ R√©cup syst√©mique`),1000)
    }
    if(currentWeek===10){
        setTimeout(()=>showModal('üéâ','DELOAD FINAL S10',`Volume -50% ‚Ä¢ Charges -10% ‚Ä¢ R√©cup avant transition`),1000)
    }
    loadPhotos();updatePhotoComparison();
    document.getElementById('current-photo-week').textContent=currentWeek;
}

function changeWeek(delta){const newWeek=currentWeek+delta;if(newWeek>=1&&newWeek<=10){currentWeek=newWeek;updateWeekDisplay();loadAllData();checkPhotoReminders();generate8WeeksView()}}
function resetWeek(){if(confirm('Remettre √† Semaine 1 ?')){currentWeek=1;updateWeekDisplay();loadAllData();checkPhotoReminders();generate8WeeksView()}}

function prefillInputs(day){
    const inputs=document.querySelectorAll(`#tab-${day} input[type="text"][data-exercise]`);
    inputs.forEach(input=>{
        const exerciseId=input.dataset.exercise,inputId=input.id;
        const saved=localStorage.getItem(`workout-${day}-w${currentWeek}`);
        if(saved){
            const data=JSON.parse(saved);
            if(data.exercises&&data.exercises[inputId]){
                input.value=data.exercises[inputId];setInputState(input,'green');
                inputStates[inputId]={isPrefilled:false,isModified:false,isSaved:true,originalValue:data.exercises[inputId]};
                return;
            }
        }
        let prefillValue=null;
        if(currentWeek===1){const baseline=baselineProgram[exerciseId];if(baseline){prefillValue=baseline.weight?`${baseline.weight}√ó${baseline.reps}`:`${baseline.reps}`}}
        else{
            const lastWeek=currentWeek-1,lastWeekData=localStorage.getItem(`workout-${day}-w${lastWeek}`);
            if(lastWeekData){const data=JSON.parse(lastWeekData);if(data.exercises&&data.exercises[inputId]){prefillValue=data.exercises[inputId]}}
            else if(baselineProgram[exerciseId]){const baseline=baselineProgram[exerciseId];prefillValue=baseline.weight?`${baseline.weight}√ó${baseline.reps}`:`${baseline.reps}`}
        }
        if(prefillValue){input.value=prefillValue;input.placeholder=prefillValue;setInputState(input,'red');inputStates[inputId]={isPrefilled:true,isModified:false,isSaved:false,originalValue:prefillValue}}
    });
}

function setInputState(input,state){input.classList.remove('input-red','input-yellow','input-green');input.classList.add(`input-${state}`)}

function handleInput(input){
    const inputId=input.id,currentValue=input.value;
    if(!inputStates[inputId]){inputStates[inputId]={isPrefilled:false,isModified:false,isSaved:false,originalValue:''}}
    const state=inputStates[inputId];
    if(state.isPrefilled&&currentValue!==state.originalValue){state.isModified=true;state.isPrefilled=false;setInputState(input,'yellow')}
    else if(!state.isPrefilled&&currentValue){state.isModified=true;setInputState(input,'yellow')}
    autoSave();analyzeExercisePerformance(input.dataset.exercise);
}

function analyzeExercisePerformance(exerciseId){
    const inputs=document.querySelectorAll(`input[data-exercise="${exerciseId}"]`);
    const series=[];let targetReps=8;
    inputs.forEach(input=>{
        if(input.value){const match=input.value.match(/(\d+)√ó(\d+)|^(\d+)$/);if(match){const reps=match[2]?parseInt(match[2]):parseInt(match[3]);series.push({reps:reps})}}
        targetReps=parseInt(input.dataset.target)||8;
    });
    if(series.length===0)return;
    const totalSeries=series.length,successfulSeries=series.filter(s=>s.reps>=targetReps).length,failedSeries=totalSeries-successfulSeries;
    const allPerfect=series.every(s=>s.reps>=targetReps+2),allTarget=series.every(s=>s.reps===targetReps);
    let emoji,message,adjustment,cssClass;
    if(allPerfect){emoji='üü¢';adjustment='+5kg';message='Excellent ! Toutes s√©ries au-del√† de l\'objectif, augmente la charge';cssClass='perfect'}
    else if(allTarget){emoji='üü°';adjustment='+2.5kg';message='Toutes s√©ries r√©ussies pile-poil, progression possible';cssClass='easy'}
    else if(failedSeries<=1){emoji='üü†';adjustment='Maintien';message='Derni√®re s√©rie difficile, consolide avant d\'augmenter';cssClass='good'}
    else if(failedSeries===2){emoji='üî¥';adjustment='-2.5kg';message='Trop difficile, r√©duis l√©g√®rement la charge';cssClass='hard'}
    else{emoji='‚ö´';adjustment='-5kg';message='Charge trop √©lev√©e, baisse significativement';cssClass='too_hard'}
    const analysisDiv=document.getElementById(`analysis-${exerciseId}`);
    if(analysisDiv){analysisDiv.innerHTML=`${emoji} ${message} (Ajustement: <strong>${adjustment}</strong>)`;analysisDiv.className='performance-analysis '+cssClass;analysisDiv.style.display='block'}
}

function autoSave(){
    clearTimeout(autoSaveTimeout);
    autoSaveTimeout=setTimeout(()=>{
        const activeTab=document.querySelector('.tab-content.active').id.replace('tab-','');
        if(['lundi','mercredi','vendredi'].includes(activeTab)){
            saveWorkoutData(activeTab);showAutoSaveIndicator();
            const inputs=document.querySelectorAll(`#tab-${activeTab} input[type="text"][data-exercise]`);
            inputs.forEach(input=>{if(input.value&&inputStates[input.id]){inputStates[input.id].isSaved=true;inputStates[input.id].isModified=false;setInputState(input,'green')}});
        }
    },1500);
}

function showAutoSaveIndicator(){const indicator=document.getElementById('auto-save-indicator');indicator.classList.add('show');setTimeout(()=>indicator.classList.remove('show'),2000)}

function saveWorkoutData(day){
    const data={date:new Date().toISOString().split('T')[0],week:currentWeek,day:day,exercises:{},notes:document.getElementById('notes-'+day)?.value||''};
    const inputs=document.querySelectorAll('#tab-'+day+' input[type="text"]');
    inputs.forEach(input=>{if(input.value){data.exercises[input.id]=input.value}});
    localStorage.setItem(`workout-${day}-w${currentWeek}`,JSON.stringify(data));
    const history=JSON.parse(localStorage.getItem('workoutHistory')||'[]');
    const existingIndex=history.findIndex(w=>w.day===day&&w.week===currentWeek);
    if(existingIndex>=0)history[existingIndex]=data;else history.push(data);
    localStorage.setItem('workoutHistory',JSON.stringify(history));
}

function loadAllData(){['lundi','mercredi','vendredi'].forEach(day=>{prefillInputs(day);loadLastWeekData(day)});loadProgressData();generate8WeeksView()}

function loadLastWeekData(day){
    if(currentWeek===1)return;
    const lastWeek=currentWeek-1,saved=localStorage.getItem(`workout-${day}-w${lastWeek}`);
    const exerciseMap={
        'lundi':[{id:'lun-elev',display:'lastweek-lun-elev',keys:['lun-1-s1','lun-1-s2']},{id:'lun-face',display:'lastweek-lun-face',keys:['lun-2-s1','lun-2-s2']},{id:'lun-incline',display:'lastweek-lun-incline',keys:['lun-3-s1','lun-3-s2','lun-3-s3']}],
        'mercredi':[{id:'mer-tractions',display:'lastweek-mer-tractions',keys:['mer-1-s1','mer-1-s2','mer-1-s3','mer-1-s4','mer-1-s5']},{id:'mer-rowing',display:'lastweek-mer-rowing',keys:['mer-2-s1','mer-2-s2']}],
        'vendredi':[{id:'ven-rdl',display:'lastweek-ven-rdl',keys:['ven-1-s1','ven-1-s2']},{id:'ven-hip',display:'lastweek-ven-hip',keys:['ven-2-s1','ven-2-s2']}]
    };
    if(!saved){(exerciseMap[day]||[]).forEach(ex=>{const elem=document.getElementById(ex.display);if(elem)elem.textContent='üíæ Pas de donn√©es semaine pr√©c√©dente'});return}
    const data=JSON.parse(saved);
    (exerciseMap[day]||[]).forEach(ex=>{const values=ex.keys.map(k=>data.exercises[k]).filter(v=>v);if(values.length>0){const elem=document.getElementById(ex.display);if(elem)elem.textContent=`üíæ S${lastWeek}: ${values.join(', ')}`}});
}

function loadProgressData(){
    const measures=localStorage.getItem('currentMeasures');
    if(measures){const data=JSON.parse(measures);['poids','taille'].forEach(key=>{const elem=document.getElementById('prog-'+key);if(elem&&data[key])elem.value=data[key]})}
    const progress=localStorage.getItem('currentProgress');
    if(progress){const data=JSON.parse(progress);['incline','tractions','rdl'].forEach(key=>{const elem=document.getElementById('prog-'+key);if(elem&&data[key])elem.value=data[key]})}
}

function saveProgressData(){
    const measures={poids:document.getElementById('prog-poids')?.value||'',taille:document.getElementById('prog-taille')?.value||''};
    localStorage.setItem('currentMeasures',JSON.stringify(measures));
    const progress={incline:document.getElementById('prog-incline')?.value||'',tractions:document.getElementById('prog-tractions')?.value||'',rdl:document.getElementById('prog-rdl')?.value||''};
    localStorage.setItem('currentProgress',JSON.stringify(progress));
    showAutoSaveIndicator();generate8WeeksView();
}

function showTab(tabName){
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById('tab-'+tabName).classList.add('active');
    event.target.classList.add('active');
    if(['lundi','mercredi','vendredi'].includes(tabName)){startSessionTimer();prefillInputs(tabName)}else stopSessionTimer();
    if(tabName==='progression')loadHistory();
    if(tabName==='evolution')generate8WeeksView();
}

function startTimer(seconds){
    stopTimer();timeLeft=seconds;updateTimerDisplay();
    timerInterval=setInterval(()=>{
        timeLeft--;updateTimerDisplay();
        if(timeLeft===10)document.getElementById('timer-display').classList.add('warning');
        if(timeLeft<=0){stopTimer();playLoudBeep();if('vibrate'in navigator)navigator.vibrate([500,200,500]);if(Notification.permission==='granted')new Notification('‚è∞ Repos termin√© !',{body:'Go next s√©rie ! üí™'});showModal('‚è∞','Repos termin√© !','Go next s√©rie ! üí™')}
    },1000);
}

function stopTimer(){if(timerInterval){clearInterval(timerInterval);timerInterval=null}timeLeft=0;updateTimerDisplay();document.getElementById('timer-display').classList.remove('warning')}
function updateTimerDisplay(){const minutes=Math.floor(timeLeft/60),seconds=timeLeft%60;document.getElementById('timer-display').textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`}

function playLoudBeep(){
    const context=new(window.AudioContext||window.webkitAudioContext)();
    for(let i=0;i<3;i++){
        setTimeout(()=>{
            const oscillator=context.createOscillator(),gainNode=context.createGain();
            oscillator.connect(gainNode);gainNode.connect(context.destination);
            oscillator.frequency.value=800;oscillator.type='square';gainNode.gain.setValueAtTime(0.5,context.currentTime);
            oscillator.start(context.currentTime);oscillator.stop(context.currentTime+0.3);
        },i*400);
    }
}

function startSessionTimer(){
    if(!sessionPaused){stopSessionTimer();sessionSeconds=0;sessionStartTime=Date.now()}
    else{sessionStartTime=Date.now()-(sessionSeconds*1000)}
    sessionPaused=false;document.getElementById('session-timer').style.display='block';
    document.getElementById('pause-session-btn').textContent='‚è∏ Pause';
    sessionTimerInterval=setInterval(()=>{
        sessionSeconds=Math.floor((Date.now()-sessionStartTime)/1000);
        updateSessionTimerDisplay();
        if(sessionSeconds===2700&&!sessionPaused){showModal('‚ö†Ô∏è','45 minutes !','Acc√©l√®re le rythme');if(Notification.permission==='granted')new Notification('‚ö†Ô∏è 45min',{body:'Acc√©l√®re'})}
        if(sessionSeconds===4500&&!sessionPaused){showModal('üî•','75 minutes !','Termine rapidement');if(Notification.permission==='granted')new Notification('üî• 75min',{body:'Termine vite'})}
    },1000);
}

function pauseSessionTimer(){
    if(sessionTimerInterval){clearInterval(sessionTimerInterval);sessionTimerInterval=null;sessionPaused=true;document.getElementById('pause-session-btn').textContent='‚ñ∂Ô∏è Reprendre'}
    else if(sessionPaused)startSessionTimer();
}

function stopSessionTimer(){if(sessionTimerInterval){clearInterval(sessionTimerInterval);sessionTimerInterval=null}document.getElementById('session-timer').style.display='none';sessionSeconds=0;sessionPaused=false;sessionStartTime=null}
function updateSessionTimerDisplay(){const minutes=Math.floor(sessionSeconds/60),seconds=sessionSeconds%60;document.getElementById('session-timer-display').textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`}

function endSession(){const activeTab=document.querySelector('.tab-content.active').id.replace('tab-','');if(!['lundi','mercredi','vendredi'].includes(activeTab))return;document.getElementById('feedback-modal').classList.add('show')}
function closeFeedbackModal(){document.getElementById('feedback-modal').classList.remove('show')}

function updateSliderValue(sliderId){const slider=document.getElementById(sliderId);const valueSpan=document.getElementById(sliderId+'-value');valueSpan.textContent=slider.value+'/10';validateFeedbackForm()}

function updateCharCounter(){
    const textarea=document.getElementById('feedback-notes'),counter=document.getElementById('char-counter'),length=textarea.value.length;
    counter.textContent=`${length}/20 caract√®res`;
    if(length>=20){counter.classList.add('valid');counter.classList.remove('invalid')}else{counter.classList.add('invalid');counter.classList.remove('valid')}
    validateFeedbackForm();
}

function validateFeedbackForm(){
    const notesLength=document.getElementById('feedback-notes').value.length;
    const isValid=notesLength>=20;
    document.getElementById('generate-report-btn').disabled=!
        isValid;
    document.getElementById('open-chatgpt-btn').disabled=!isValid;
    document.getElementById('email-report-btn').disabled=!isValid;
}

function generateStructuredReport(day,duration,feedback){
    const dayNames={'lundi':'LUNDI - PUSH + √âPAULES','mercredi':'MERCREDI - PULL','vendredi':'VENDREDI - LEGS'};
    const data=JSON.parse(localStorage.getItem(`workout-${day}-w${currentWeek}`)||'{}');
    let report=`üèãÔ∏è RAPPORT S√âANCE STRUCTUR√â - MASSE BUILDER S√àCHE v3.1 ULTIMATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìÖ DATE: ${new Date().toLocaleDateString('fr-FR')}
üìç SEMAINE: ${currentWeek}/10
üéØ S√âANCE: ${dayNames[day]||day.toUpperCase()}
‚è±Ô∏è DUR√âE: ${duration} minutes

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä CHARGES R√âALIS√âES PAR EXERCICE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

`;
    if(data.exercises){Object.entries(data.exercises).forEach(([key,value])=>{const cleanKey=key.replace(/lun-|mer-|ven-/g,'').toUpperCase();report+=`${cleanKey}: ${value}\n`})}
    report+=`
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí≠ DONN√âES SUBJECTIVES
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

√ânergie pr√©-workout: ${feedback.energie}/10
Qualit√© sommeil: ${feedback.sommeil}/10
Congestion musculaire: ${feedback.congestion}/10
Douleurs articulaires: ${feedback.douleurs}/10
RPE global s√©ance: ${feedback.rpe}/10

Notes: ${feedback.notes}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üî• PROTOCOLES THERMIQUES EFFECTU√âS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

`;
    if(day==='lundi'||day==='vendredi'){
        report+=`‚úÖ PROTOCOLE ANTI-INFLAMMATOIRE (16h30)
- Sauna 85¬∞C: 2√ó10min
- Piscine froide: 3min
- Spa 40¬∞C: 10min
Effet attendu: -40% douleurs\n\n`;
    }
    if(day==='mercredi'){
        report+=`üåô PROTOCOLE D√âTENTE OPTIONNEL (20h30)
- Spa 38-40¬∞C: 15min
- Piscine froide: 2-3min
- Sauna doux 75-80¬∞C: 10min
Effet attendu: Sommeil +20%\n\n`;
    }
    report+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÆ PROMPT ANALYSE IA
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

"Analyse ce rapport de s√©ance musculation S√àCHE avec protocoles thermiques:
- Identifie patterns de progression/stagnation
- D√©tecte d√©s√©quilibres potentiels
- Sugg√®re ajustements charges/volume
- √âvalue impact protocoles thermiques sur r√©cup√©ration
- Rep√®re signaux surentra√Ænement
- Recommande focus semaine prochaine
- √âvalue maintien force pendant d√©ficit calorique"
`;
    return report;
}

function copyReport(){
    const activeTab=document.querySelector('.tab-content.active').id.replace('tab-','');
    const duration=Math.floor(sessionSeconds/60);
    const feedback={energie:document.getElementById('energie').value,sommeil:document.getElementById('sommeil').value,congestion:document.getElementById('congestion').value,douleurs:document.getElementById('douleurs').value,rpe:document.getElementById('rpe').value,notes:document.getElementById('feedback-notes').value};
    generatedReport=generateStructuredReport(activeTab,duration,feedback);
    navigator.clipboard.writeText(generatedReport).then(()=>{alert('‚úÖ Rapport copi√© !');closeFeedbackModal();stopSessionTimer()});
}

function openChatGPT(){
    const activeTab=document.querySelector('.tab-content.active').id.replace('tab-','');
    const duration=Math.floor(sessionSeconds/60);
    const feedback={energie:document.getElementById('energie').value,sommeil:document.getElementById('sommeil').value,congestion:document.getElementById('congestion').value,douleurs:document.getElementById('douleurs').value,rpe:document.getElementById('rpe').value,notes:document.getElementById('feedback-notes').value};
    generatedReport=generateStructuredReport(activeTab,duration,feedback);
    const url=`https://chatgpt.com/?q=${encodeURIComponent(generatedReport)}`;
    window.open(url,'_blank');
    closeFeedbackModal();stopSessionTimer();
}

function emailReport(){
    const activeTab=document.querySelector('.tab-content.active').id.replace('tab-','');
    const duration=Math.floor(sessionSeconds/60);
    const feedback={energie:document.getElementById('energie').value,sommeil:document.getElementById('sommeil').value,congestion:document.getElementById('congestion').value,douleurs:document.getElementById('douleurs').value,rpe:document.getElementById('rpe').value,notes:document.getElementById('feedback-notes').value};
    generatedReport=generateStructuredReport(activeTab,duration,feedback);
    const mailto=`mailto:coach@email.com?subject=Rapport S√©ance S${currentWeek}&body=${encodeURIComponent(generatedReport)}`;
    window.open(mailto);
    closeFeedbackModal();stopSessionTimer();
}

function checkPhotoReminders(){
    const photoWeeks=[0,4,8,10],reminderDiv=document.getElementById('photo-reminder');
    if(!reminderDiv)return;
    if(photoWeeks.includes(currentWeek)){
        const message=currentWeek===0?'AVANT (face/dos/profil)':currentWeek===4?'MI-PARCOURS (4 sem)':currentWeek===8?'PRESQUE FIN (8 sem)':'FINALES';
        reminderDiv.innerHTML=`<div class="warning">üì∏ S${currentWeek} : Prends tes photos ${message}</div>`;
    }else reminderDiv.innerHTML=`<div class="success">‚úÖ Prochaines photos: Semaine ${photoWeeks.find(w=>w>currentWeek)||10}</div>`;
}

function uploadPhoto(type){currentPhotoType=type;document.getElementById('photo-input').click()}

function handlePhotoUpload(){
    const file=document.getElementById('photo-input').files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=function(e){
        const img=new Image();
        img.onload=function(){
            const canvas=document.createElement('canvas'),maxSize=800;
            let width=img.width,height=img.height;
            if(width>height){if(width>maxSize){height*=maxSize/width;width=maxSize}}else{if(height>maxSize){width*=maxSize/height;height=maxSize}}
            canvas.width=width;canvas.height=height;
            const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,width,height);
            const compressedData=canvas.toDataURL('image/jpeg',0.7);
            savePhoto(currentPhotoType,compressedData);
        };img.src=e.target.result;
    };reader.readAsDataURL(file);
}

function savePhoto(type,dataUrl){
    const key=`photo-w${currentWeek}-${type}`;localStorage.setItem(key,dataUrl);
    const imgElement=document.getElementById(`photo-${type}`),placeholder=document.getElementById(`placeholder-${type}`),photoItem=imgElement.parentElement;
    imgElement.src=dataUrl;imgElement.style.display='block';placeholder.style.display='none';photoItem.classList.add('has-photo');
    showAutoSaveIndicator();updatePhotoComparison();
}

function deletePhoto(type,event){
    event.stopPropagation();if(!confirm('Supprimer ?'))return;
    const key=`photo-w${currentWeek}-${type}`;localStorage.removeItem(key);
    const imgElement=document.getElementById(`photo-${type}`),placeholder=document.getElementById(`placeholder-${type}`),photoItem=imgElement.parentElement;
    imgElement.style.display='none';placeholder.style.display='flex';photoItem.classList.remove('has-photo');
    updatePhotoComparison();
}

function loadPhotos(){
    ['face','dos','profil'].forEach(type=>{
        const key=`photo-w${currentWeek}-${type}`,dataUrl=localStorage.getItem(key);
        const imgElement=document.getElementById(`photo-${type}`),placeholder=document.getElementById(`placeholder-${type}`),photoItem=imgElement.parentElement;
        if(dataUrl){imgElement.src=dataUrl;imgElement.style.display='block';placeholder.style.display='none';photoItem.classList.add('has-photo')}
        else{imgElement.style.display='none';placeholder.style.display='flex';photoItem.classList.remove('has-photo')}
    });
}

function updatePhotoComparison(){
    const comparisonDiv=document.getElementById('photo-comparison');
    if(!comparisonDiv)return;
    const weeks=[0,1,4,8,10];
    const hasAnyPhotos=weeks.some(w=>localStorage.getItem(`photo-w${w}-face`)||localStorage.getItem(`photo-w${w}-dos`)||localStorage.getItem(`photo-w${w}-profil`));
    if(!hasAnyPhotos){comparisonDiv.innerHTML='<p style="color: #999; text-align: center;">Prends tes premi√®res photos !</p>';return}
    let html='';
    weeks.forEach(week=>{
        const hasFace=localStorage.getItem(`photo-w${week}-face`),hasDos=localStorage.getItem(`photo-w${week}-dos`),hasProfil=localStorage.getItem(`photo-w${week}-profil`);
        if(hasFace||hasDos||hasProfil){
            html+=`<div class="comparison-week"><h4>S${week}</h4><div class="comparison-photos">`;
            ['face','dos','profil'].forEach(type=>{
                const photoKey=`photo-w${week}-${type}`,photoData=localStorage.getItem(photoKey);
                if(photoData)html+=`<div class="comparison-photo"><img src="${photoData}"></div>`;
                else html+=`<div class="comparison-photo" style="background: #e0e0e0;"></div>`;
            });
            html+=`</div></div>`;
        }
    });
    comparisonDiv.innerHTML=html;
}

function analyzePhotosWithAI(){
    const photos=[];
    ['face','dos','profil'].forEach(type=>{
        const photoData=localStorage.getItem(`photo-w${currentWeek}-${type}`);
        if(photoData)photos.push({type:type,data:photoData});
    });
    if(photos.length===0){alert('‚ùå Aucune photo √† analyser');return}
    const prompt=`Analyse ces photos de progression musculation S√àCHE (Semaine ${currentWeek}/10):\n\n- Identifie points forts et retards musculaires\n- √âvalue sym√©trie et proportions\n- Sugg√®re ajustements programme\n- √âvalue perte de gras vs maintien musculaire\n- Impact des protocoles thermiques sur r√©cup√©ration`;
    window.open('https://chatgpt.com/?model=gpt-4o','_blank');
    navigator.clipboard.writeText(prompt);
    alert('‚úÖ Prompt copi√© !\n\nColle-le dans ChatGPT Vision et uploade tes photos pour analyse.');
}

function exportReport(){
    const history=JSON.parse(localStorage.getItem('workoutHistory')||'[]'),measures=JSON.parse(localStorage.getItem('currentMeasures')||'{}');
    let report=`üìä BILAN MASSE BUILDER S√àCHE v3.1 ULTIMATE\nüìÖ ${new Date().toLocaleDateString('fr-FR')}\nüóìÔ∏è Semaine: ${currentWeek}/10\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìè MESURES\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nPoids: ${measures.poids||'?'} kg\nTaille: ${measures.taille||'?'} cm\n\n`;
    report+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüî• PROTOCOLES THERMIQUES\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚úÖ McGill Big 3: 6√ó/semaine\n‚úÖ Anti-inflam: Lundi+Vendredi\nüåô D√©tente: Mercredi (option)\n\n`;
    if(history.length>0){report+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüèãÔ∏è HISTORIQUE (${history.length})\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;const recent=history.slice(-6).reverse();recent.forEach((w,i)=>{report+=`\n${i+1}. ${w.day.toUpperCase()} S${w.week} - ${w.date}\n`;const exercises=Object.entries(w.exercises).slice(0,6);exercises.forEach(([key,val])=>report+=`   ${key}: ${val}\n`);if(w.notes)report+=`   üìù ${w.notes.substring(0,80)}\n`})}
    navigator.clipboard.writeText(report);showModal('üìã','Rapport copi√© !','Colle-le pour ton coach');
}

function emailCoach(){const report=exportReport();const mailto=`mailto:coach@email.com?subject=Bilan S${currentWeek}&body=${encodeURIComponent(report)}`;window.open(mailto)}

function loadHistory(){
    const history=JSON.parse(localStorage.getItem('workoutHistory')||'[]'),historyDiv=document.getElementById('workout-history');
    if(history.length===0){historyDiv.innerHTML='<p style="color: #999;">Aucune s√©ance</p>';return}
    const recent=history.slice(-10).reverse();let html='';
    recent.forEach(workout=>{html+=`<div style="background: white; padding: 10px; margin: 8px 0; border-radius: 8px;"><strong>${workout.day.toUpperCase()}</strong> S${workout.week} - ${workout.date}${workout.notes?'<br><small>'+workout.notes.substring(0,50)+'...</small>':''}</div>`});
    historyDiv.innerHTML=html;
}

function generate8WeeksView(){
    const overview=document.getElementById('week-overview');
    if(!overview)return;
    let html='';
    for(let w=1;w<=10;w++){
        const badge=w<currentWeek?'completed':w===currentWeek?'current':'future';
        html+=`<span class="week-badge ${badge}">S${w}</span>`;
    }
    overview.innerHTML=html;
    
    generateExerciseTable('incline','lundi',['lun-3-s1','lun-3-s2','lun-3-s3','lun-3-s4','lun-3-s5']);
    generateExerciseTable('rdl','vendredi',['ven-1-s1','ven-1-s2','ven-1-s3','ven-1-s4','ven-1-s5']);
    generateExerciseTable('tractions','mercredi',['mer-1-s1','mer-1-s2','mer-1-s3','mer-1-s4','mer-1-s5']);
    generateBodyTable();
}

function generateExerciseTable(name,day,keys){
    const table=document.getElementById(`table-${name}`);
    if(!table)return;
    const tbody=table.querySelector('tbody');
    tbody.innerHTML='';
    for(let w=1;w<=10;w++){
        const data=localStorage.getItem(`workout-${day}-w${w}`);
        if(data){
            const workout=JSON.parse(data);
            let row='<tr><td>S'+w+'</td>';
            keys.forEach(key=>{row+=`<td>${workout.exercises[key]||'-'}</td>`});
            row+='<td>-</td><td>-</td></tr>';
            tbody.innerHTML+=row;
        }
    }
}

function generateBodyTable(){
    const table=document.getElementById('table-body');
    if(!table)return;
    const tbody=table.querySelector('tbody');
    tbody.innerHTML='';
    let baseWeight=null,baseTaille=null;
    for(let w=1;w<=10;w++){
        const saved=localStorage.getItem(`measures-w${w}`);
        if(saved){
            const m=JSON.parse(saved);
            if(w===1){baseWeight=parseFloat(m.poids)||null;baseTaille=parseFloat(m.taille)||null}
            const deltaW=baseWeight?(parseFloat(m.poids)-baseWeight).toFixed(1):'-';
            const deltaT=baseTaille?(parseFloat(m.taille)-baseTaille).toFixed(1):'-';
            tbody.innerHTML+=`<tr><td>S${w}</td><td>${m.poids||'-'}</td><td>${deltaW}</td><td>${m.taille||'-'}</td><td>${deltaT}</td></tr>`;
        }
    }
}

function showModal(icon,title,text){document.getElementById('modal-icon').textContent=icon;document.getElementById('modal-title').textContent=title;document.getElementById('modal-text').textContent=text;document.getElementById('progression-modal').classList.add('show')}
function closeModal(){document.getElementById('progression-modal').classList.remove('show')}

// üÜï NOUVEAU: Fonctions pour protocoles thermiques
function showThermalProtocol(day){
    let title,content;
    if(day==='lundi'||day==='vendredi'){
        title='üî• Protocole Anti-Inflammatoire (16h30)';
        content=`
        <div style="margin-bottom: 15px;">
            <strong>‚è±Ô∏è Dur√©e totale: 35 minutes</strong>
        </div>
        
        <div style="background: #f8f9ff; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>1. SAUNA TH√âRAPEUTIQUE (20 min)</strong><br>
            ‚Ä¢ Temp√©rature: 85¬∞C<br>
            ‚Ä¢ 2 sessions de 10 minutes<br>
            ‚Ä¢ Loyly mod√©r√© (3-4 louches)<br>
            ‚Ä¢ Pause hydratation entre sessions<br>
            ‚Ä¢ Respiration profonde et calme
        </div>
        
        <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>2. PISCINE FROIDE (3 min)</strong><br>
            ‚Ä¢ Immersion progressive<br>
            ‚Ä¢ Focus sur articulations douloureuses<br>
            ‚Ä¢ Mouvements doux dans l'eau<br>
            ‚Ä¢ Respiration contr√¥l√©e
        </div>
        
        <div style="background: #fff9e6; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>3. SPA TH√âRAPEUTIQUE (10 min)</strong><br>
            ‚Ä¢ Temp√©rature: 40¬∞C<br>
            ‚Ä¢ Jets cibl√©s sur:<br>
            &nbsp;&nbsp;- √âpaules (priorit√©)<br>
            &nbsp;&nbsp;- Genoux<br>
            &nbsp;&nbsp;- Coudes<br>
            &nbsp;&nbsp;- Bas du dos
        </div>
        
        <div style="background: #ffebee; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>üìä R√âSULTATS ATTENDUS:</strong><br>
            ‚Ä¢ Douleurs articulaires: -40%<br>
            ‚Ä¢ Inflammation: -30%<br>
            ‚Ä¢ R√©cup√©ration: +35%<br>
            ‚Ä¢ Qualit√© sommeil: +15%
        </div>`;
    }else if(day==='mercredi'){
        title='üåô Protocole D√©tente (20h30)';
        content=`
        <div style="margin-bottom: 15px;">
            <strong>‚è±Ô∏è Dur√©e totale: 30 minutes</strong><br>
            <em>Optionnel - Pour optimiser le sommeil</em>
        </div>
        
        <div style="background: #f8f9ff; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>1. SPA/JACUZZI RELAXATION (15 min)</strong><br>
            ‚Ä¢ Temp√©rature: 38-40¬∞C<br>
            ‚Ä¢ Jets l√©gers sur tout le corps<br>
            ‚Ä¢ Relaxation compl√®te<br>
            ‚Ä¢ Musique calme (pas d'√©cran)<br>
            ‚Ä¢ M√©ditation l√©g√®re
        </div>
        
        <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>2. PISCINE FROIDE (2-3 min)</strong><br>
            ‚Ä¢ Immersion compl√®te<br>
            ‚Ä¢ Contraste thermique final<br>
            ‚Ä¢ Active le syst√®me parasympathique<br>
            ‚Ä¢ Pr√©pare au sommeil profond
        </div>
        
        <div style="background: #fff9e6; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>3. SAUNA DOUX - OPTIONNEL (10 min)</strong><br>
            ‚Ä¢ Temp√©rature: 75-80¬∞C (plus doux)<br>
            ‚Ä¢ Loyly tr√®s l√©ger (1-2 louches)<br>
            ‚Ä¢ D√©tente musculaire finale<br>
            ‚Ä¢ √âvacuation stress r√©siduel
        </div>
        
        <div style="background: #ffebee; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>üìä ROUTINE POST-PROTOCOLE:</strong><br>
            ‚Ä¢ Douche ti√®de (pas chaude)<br>
            ‚Ä¢ V√™tements confortables<br>
            ‚Ä¢ Hydratation (tisane camomille)<br>
            ‚Ä¢ Lecture 20min (pas d'√©cran)<br>
            ‚Ä¢ Coucher dans les 60min
        </div>
        
        <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>‚ú® B√âN√âFICES:</strong><br>
            ‚Ä¢ Endormissement: -50% temps<br>
            ‚Ä¢ Sommeil profond: +20%<br>
            ‚Ä¢ Cortisol: -25%<br>
            ‚Ä¢ R√©cup√©ration nocturne: +30%
        </div>`;
    }
    document.getElementById('thermal-title').textContent=title;
    document.getElementById('thermal-content').innerHTML=content;
    document.getElementById('thermal-protocol-modal').classList.add('show');
}

function closeThermalModal(){
    document.getElementById('thermal-protocol-modal').classList.remove('show');
}
// FIN fonctions protocoles thermiques üÜï

function setupNotifications(){
    if(!('Notification'in window)){document.getElementById('notif-status').innerHTML='<div class="alert">‚ùå Non support√©</div>';return}
    if(Notification.permission==='granted'){document.getElementById('notif-status').innerHTML='<div class="success">‚úÖ Activ√©es !</div>';return}
    Notification.requestPermission().then(permission=>{
        if(permission==='granted'){document.getElementById('notif-status').innerHTML='<div class="success">‚úÖ Activ√©es !</div>';new Notification('üí™ Masse Builder',{body:'Notifs ON !'})}
        else document.getElementById('notif-status').innerHTML='<div class="alert">‚ùå Refus√©es</div>';
    });
}

function openDemo(url){
    window.open(url,'_blank').onerror=()=>{
        alert('‚ùå Impossible d\'ouvrir la vid√©o.\nV√©rifie ta connexion ou copie le lien manuellement.');
        navigator.clipboard.writeText(url);
    };
}

// ============================================
// üÜï NOUVEAU: FONCTIONNALIT√âS v3.2 ULTIMATE
// ============================================

// --- 1. AUTO-SAVE AM√âLIOR√â ---
let lastCompletedInput = null;
let currentExerciseContext = null;

function enhancedAutoSave(){
    const indicator = document.getElementById('auto-save-indicator');
    indicator.innerHTML = 'üíæ Sauvegarde...';
    indicator.classList.add('show');

    setTimeout(() => {
        autoSave(); // Appel de la fonction d'origine
        indicator.innerHTML = '‚úÖ Sauvegard√©';
        setTimeout(() => indicator.classList.remove('show'), 1500);
    }, 300);
}

// --- 2. TIMER FLOTTANT PERSISTANT ---
let floatingTimerInterval = null;
let floatingTimeLeft = 0;
let currentExerciseName = '';

function startFloatingTimer(seconds, exerciseName = '') {
    stopFloatingTimer();
    floatingTimeLeft = seconds;
    currentExerciseName = exerciseName;

    const floatingTimer = document.getElementById('floating-timer');
    const titleElem = document.getElementById('floating-timer-title');

    titleElem.textContent = exerciseName ? `‚è±Ô∏è ${exerciseName}` : '‚è±Ô∏è REPOS';
    floatingTimer.classList.add('active');

    updateFloatingTimerDisplay();

    floatingTimerInterval = setInterval(() => {
        floatingTimeLeft--;
        updateFloatingTimerDisplay();

        if(floatingTimeLeft === 10) {
            document.getElementById('floating-timer-display').classList.add('warning');
        }

        if(floatingTimeLeft <= 0) {
            stopFloatingTimer();
            playLoudBeep();
            if('vibrate' in navigator) navigator.vibrate([500,200,500,200,500]);
            if(Notification.permission === 'granted') {
                new Notification('‚è∞ Repos termin√© !', {body: 'Go next s√©rie ! üí™'});
            }
            showModal('‚è∞', 'Repos termin√© !', 'Pr√™t pour la s√©rie suivante ! üí™');
        }
    }, 1000);
}

function updateFloatingTimerDisplay() {
    const minutes = Math.floor(floatingTimeLeft / 60);
    const seconds = floatingTimeLeft % 60;
    document.getElementById('floating-timer-display').textContent =
        `${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
}

function stopFloatingTimer() {
    if(floatingTimerInterval) {
        clearInterval(floatingTimerInterval);
        floatingTimerInterval = null;
    }
    document.getElementById('floating-timer').classList.remove('active');
    document.getElementById('floating-timer-display').classList.remove('warning');
    floatingTimeLeft = 0;
}

function floatingTimerAdd30() {
    floatingTimeLeft += 30;
    updateFloatingTimerDisplay();
    document.getElementById('floating-timer-display').classList.remove('warning');
}

function floatingTimerStop() {
    stopFloatingTimer();
}

// --- 3. GUIDAGE TRANSITION AUTOMATIQUE ---
let lastInputCompletedTime = 0;
let guidanceTimeout = null;

function detectSeriesCompletion(input) {
    // D√©tecte si une s√©rie vient d'√™tre compl√©t√©e
    const inputId = input.id;
    const value = input.value.trim();

    if(value && value.length > 0) {
        clearTimeout(guidanceTimeout);
        lastInputCompletedTime = Date.now();

        // Attendre 800ms pour voir si l'utilisateur continue √† saisir
        guidanceTimeout = setTimeout(() => {
            // D√©terminer le temps de repos sugg√©r√©
            const exerciseId = input.dataset.exercise;
            let suggestedRest = 90; // d√©faut

            // Logique pour d√©terminer le temps de repos selon l'exercice
            if(exerciseId && (exerciseId.includes('1') || exerciseId.includes('2'))) {
                // Exercices compos√©s principaux
                suggestedRest = 180; // 3 min
            } else if(exerciseId && (exerciseId.includes('3') || exerciseId.includes('4'))) {
                suggestedRest = 120; // 2 min
            } else {
                suggestedRest = 90; // 90s pour isolation
            }

            showTransitionGuide(suggestedRest, input);
        }, 800);
    }
}

function showTransitionGuide(suggestedRest, lastInput) {
    const guide = document.getElementById('transition-guide');
    const restTimeSpan = document.getElementById('suggested-rest-time');

    restTimeSpan.textContent = suggestedRest + 's';
    guide.classList.add('show');

    // Stocker le contexte pour les boutons
    currentExerciseContext = { rest: suggestedRest, input: lastInput };

    // Auto-cacher apr√®s 8 secondes
    setTimeout(() => {
        guide.classList.remove('show');
    }, 8000);
}

function hideTransitionGuide() {
    document.getElementById('transition-guide').classList.remove('show');
}

function startRestTimer() {
    if(currentExerciseContext) {
        const exerciseName = currentExerciseContext.input ?
            currentExerciseContext.input.closest('.exercise')?.querySelector('.exercise-title')?.textContent || 'Repos' : 'Repos';
        startFloatingTimer(currentExerciseContext.rest, exerciseName);
    }
    hideTransitionGuide();
}

function goToNextSet() {
    hideTransitionGuide();
    // Focus sur le prochain input vide
    if(currentExerciseContext && currentExerciseContext.input) {
        const currentInput = currentExerciseContext.input;
        const allInputs = document.querySelectorAll('input[type="text"][data-exercise]');
        const currentIndex = Array.from(allInputs).indexOf(currentInput);

        if(currentIndex >= 0 && currentIndex < allInputs.length - 1) {
            const nextInput = allInputs[currentIndex + 1];
            if(nextInput) {
                nextInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => nextInput.focus(), 300);
            }
        }
    }
}

// --- 4. TOGGLE √âCHAUFFEMENT OPTIMAL ---
function toggleWarmupMode(day) {
    const checkbox = document.getElementById(`warmup-toggle-${day}`);
    const extendedSection = document.querySelector(`.warmup-extended-${day}`);
    const modeDisplay = document.getElementById(`warmup-mode-${day}`);

    if(checkbox.checked) {
        // Mode OPTIMAL (15min)
        if(extendedSection) extendedSection.style.display = 'none';
        if(modeDisplay) modeDisplay.textContent = 'OPTIMAL (15 min)';
        localStorage.setItem(`warmup-mode-${day}`, 'optimal');
        showModal('‚ö°', 'Mode Optimal activ√©', '√âchauffement 15min : McGill Big 3 + Mobilit√© essentielle');
    } else {
        // Mode COMPLET (28min)
        if(extendedSection) extendedSection.style.display = 'block';
        if(modeDisplay) modeDisplay.textContent = 'COMPLET (28 min)';
        localStorage.setItem(`warmup-mode-${day}`, 'complete');
    }
}

function loadWarmupPreferences() {
    ['lundi', 'mercredi', 'vendredi'].forEach(day => {
        const savedMode = localStorage.getItem(`warmup-mode-${day}`);
        const checkbox = document.getElementById(`warmup-toggle-${day}`);
        const extendedSection = document.querySelector(`.warmup-extended-${day}`);
        const modeDisplay = document.getElementById(`warmup-mode-${day}`);

        if(savedMode === 'optimal' && checkbox) {
            checkbox.checked = true;
            if(extendedSection) extendedSection.style.display = 'none';
            if(modeDisplay) modeDisplay.textContent = 'OPTIMAL (15 min)';
        }
    });
}

// --- 5. AM√âLIORATION VALIDATION COULEURS ---
function improvedHandleInput(input) {
    const inputId = input.id;
    const currentValue = input.value.trim();

    // Initialiser l'√©tat si n√©cessaire
    if(!inputStates[inputId]) {
        inputStates[inputId] = {
            isPrefilled: false,
            isModified: false,
            isSaved: false,
            originalValue: input.placeholder || ''
        };
    }

    const state = inputStates[inputId];

    // Logique de couleurs
    if(!currentValue || currentValue.length === 0) {
        // ROUGE: Vide (obligatoire)
        setInputState(input, 'red');
        state.isPrefilled = false;
        state.isModified = false;
    } else if(currentValue === state.originalValue && !state.isModified) {
        // JAUNE: Valeur pr√©-remplie (√† v√©rifier)
        setInputState(input, 'yellow');
        state.isPrefilled = true;
    } else {
        // VERT: Valid√© par utilisateur
        setInputState(input, 'green');
        state.isModified = true;
        state.isSaved = false;
    }

    // Auto-save am√©lior√©
    enhancedAutoSave();

    // Analyse de performance
    analyzeExercisePerformance(input.dataset.exercise);

    // D√©tection s√©rie compl√©t√©e pour guidage
    if(currentValue && currentValue.length > 0) {
        detectSeriesCompletion(input);
    }
}

// Remplacer handleInput d'origine par la version am√©lior√©e
window.originalHandleInput = handleInput;
handleInput = improvedHandleInput;

// --- 6. INT√âGRATION TIMER FLOTTANT AVEC TIMER PRINCIPAL ---
const originalStartTimer = startTimer;
startTimer = function(seconds) {
    originalStartTimer(seconds); // Timer principal
    startFloatingTimer(seconds); // Timer flottant aussi
};

const originalStopTimer = stopTimer;
stopTimer = function() {
    originalStopTimer();
    stopFloatingTimer();
};

// --- 7. CHARGEMENT INITIAL ---
window.addEventListener('load', () => {
    loadWarmupPreferences();
    console.log('‚úÖ Masse Builder v3.2 Ultimate - Fonctionnalit√©s avanc√©es charg√©es');
});

// FIN FONCTIONNALIT√âS v3.2
    </script>
</body>
</html>
